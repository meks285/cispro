<html>
<head>
<title>Processing_Insert_main</title>
<script language="javascript">
var max_time = 5;
var cinterval;
 
function countdown_timer(){
  // decrease timer
  max_time--;
  document.getElementById('countdown').innerHTML = max_time;
  if(max_time == 0){
    clearInterval(cinterval);
  }
}
// 1,000 means 1 second.
cinterval = setInterval('countdown_timer()', 1000);
</script>
</head>

<body>
<?php 

include './mandate_/lidh.php';

$_SESSION=$_POST;
// Check connection
$query2 = "SELECT pepid FROM patient WHERE pepid = '$_POST[pepid]'";
$result2 = mysqli_query($con,$query2);
if (mysqli_num_rows($result2)==0){
	class MyClass{
    public function GetUserInformation(){
$pepid = $_POST['pepid'];
$pepid = strtoupper($pepid);
if(isset($_POST['ancno'])){ 
$ancno = $_POST['ancno']; 
} 
 else {
$ancno = "";
}
if(isset($_POST['educationallevel'])){ 
$educationallevel = $_POST['educationallevel']; 
} 
 else {
$educationallevel = "";
}
if(isset($_POST['maritalstatus'])){ 
$maritalstatus = $_POST['maritalstatus']; 
} 
 else {
$maritalstatus = "";
}
if(isset($_POST['jobstatus'])){ 
$jobstatus = $_POST['jobstatus']; 
} 
 else {
$jobstatus = "";
}
if(isset($_POST['address'])){ 
$address = $_POST['address']; 
$address=mysql_real_escape_string($address);
} 
 else {
$address = "";
}

if(isset($_POST['nokaddr'])){ 
$nokaddr = $_POST['nokaddr']; 
$nokaddr=mysql_real_escape_string($nokaddr);
} 
 else {
$nokaddr = "";
}

if(isset($_POST['addrlga'])){ 
$addrlga = $_POST['addrlga']; 
$addrlga=mysql_real_escape_string($addrlga);
} 
 else {
$addrlga = "";
}

if(isset($_POST['addrwardvillage'])){ 
$addrwardvillage = $_POST['addrwardvillage']; 
$addrwardvillage=mysql_real_escape_string($addrwardvillage);
} 
 else {
$addrwardvillage = "";
}

if(isset($_POST['nokwardvillage'])){ 
$nokwardvillage = $_POST['nokwardvillage']; 
$nokwardvillage=mysql_real_escape_string($nokwardvillage);
} 
 else {
$nokwardvillage = "";
}



$query = " INSERT INTO patient (pepid, uniqueid, hospitalid,surname,state, othernames,sex,lga,facilityname,ancno,dob,maritalstatus,educationallevel,jobstatus,address,
wardvillage,town,addrlga,phoneno,nokname,nokaddr,nokwardvillage,noktown,nokstate,nokrelationship,nokphoneno,enroldate,hivposdate)
VALUES
('$pepid','$_POST[uniqueid]','$_POST[hospitalno]','$_POST[surname]','$_POST[state]','$_POST[othernames]','$_POST[sex]',
'$_POST[lga]','$_POST[facilityname]',
'$ancno','$_POST[dob]','$maritalstatus','$educationallevel','$jobstatus','$address',
'$addrwardvillage','$_POST[addrtown]','$addrlga','$_POST[phoneno]','$_POST[nokname]','$nokaddr','$nokwardvillage','$_POST[noktown]',
'$_POST[nokstate]','$_POST[nokrelationship]','$_POST[nokphoneno]','$_POST[visitdate]','$_POST[hivposdate]')"; 

include 'lidh.php';
 
 		$info=mysqli_query($con,$query);
//		$info=mysqli_query($con,$query);
        return $info;
	} 
	
}

$class = new MyClass;
$info = $class->GetUserInformation();
echo mysqli_error($con);
header("refresh:3;./newpatientiniteval.php?username=".$_POST['username']);
session_write_close();

	$query4="insert into visit(visittype,visitdate,pepid) values('Patient Registration','$_POST[visitdate]','$_POST[pepid]')";
	$result4 = mysqli_query($con,$query4);
echo mysqli_error($con);
	echo "<p style='text-align: center;'><span style='font-size: large; font-family: georgia,palatino; color: #003366;'> Patient registered, Please Wait </br> Loading Clinical Evaluation...</span></p> </br> ";
$sql="INSERT into AUDIT_TRAIL (server_name,user_name,action) VALUES('$_SERVER[REMOTE_ADDR]','$_POST[username]','CREATE: $_POST[pepid]')";
$result=mysqli_query($con,$sql);

	
}
else{
	echo "Patient: ".$_POST['pepid']." already exists<br>";
	$query3 = "SELECT pepid FROM visit WHERE pepid = '$_POST[pepid]'";
	$result3 = mysqli_query($con,$query3);
    if (mysqli_num_rows($result3)==0){
	$query4="insert into visit(visittype,visitdate,pepid) values('Patient Registration','$_POST[visitdate]','$_POST[pepid]')";
	$result4 = mysqli_query($con,$query4);
echo mysqli_error($con);
	echo "Visit record created...";
	echo "GOING FORWARD...";
	header("refresh:3;./newpatient.php");
	}
	else{
	echo "Patient: ".$_POST['pepid']." already registered in visit table";
	echo ".";
	echo ".";
	echo ".<br>";
	echo "GOING BACK, in a moment...";
	header("refresh:3;./registration.php");
	exit();
	}

}
mysqli_close($con);
?>
   <?php 
	class MyClassndr{ 
    public function GetUserInformation(){ 
$query = "SELECT a.idpatient as PatientIdentifier,a.pepid as pepid,(select facilityname from facility) as FacilityName,CASE 
WHEN (select facilityname from facility) LIKE '%Solat%Women%' THEN 'SL'
WHEN (select facilityname from facility) LIKE '%solat%women%' THEN 'SL'
WHEN (select facilityname from facility) LIKE '%Zamko%' THEN 'ZK'
WHEN (select facilityname from facility) LIKE '%State%Specialist%Maiduguri%' THEN 'SM'
WHEN (select facilityname from facility) LIKE '%SSH%' THEN 'SM'
WHEN (select facilityname from facility) LIKE '%CHC%Zamko%' THEN 'ZK'
WHEN (select facilityname from facility) LIKE '%Comprehensive%Zamko%' THEN 'ZK'
WHEN (select facilityname from facility) LIKE '%Kwalla%' THEN 'KW'
WHEN (select facilityname from facility) LIKE '%Cottage%Hospital%Kwalla%' THEN 'KW'
WHEN (select facilityname from facility) LIKE '%cottage%hospital%kwalla%' THEN 'KW'
WHEN (select facilityname from facility) LIKE '%lasuth%' THEN 'LG'
WHEN (select facilityname from facility) LIKE '%LASUTH%' THEN 'LG'
WHEN (select facilityname from facility) LIKE '%Lagos%State%University%' THEN 'LG'
WHEN (select facilityname from facility) LIKE '%Alimosho%' THEN 'GA'
WHEN (select facilityname from facility) LIKE '%General%Alimosho%' THEN 'GA'
WHEN (select facilityname from facility) LIKE '%GH%Alimosho%' THEN 'GA'
WHEN (select facilityname from facility) LIKE '%Aregb%' THEN 'RB'
WHEN (select facilityname from facility) LIKE '%Ipaja%' THEN 'IP'
WHEN (select facilityname from facility) LIKE '%Ipaja%PHC%' THEN 'IP'
WHEN (select facilityname from facility) LIKE '%Ipaja%Primary%' THEN 'IP'
WHEN (select facilityname from facility) LIKE '%Primary%Health%Ipaja%' THEN 'IP'
WHEN (select facilityname from facility) LIKE '%Ojodu%' THEN 'OJ'
WHEN (select facilityname from facility) LIKE '%PHC%Ojodu%' THEN 'OJ'
WHEN (select facilityname from facility) LIKE '%Primary%Health%Care%Ojodu%' THEN 'OJ'
WHEN (select facilityname from facility) LIKE '%GH%Ifako%' THEN 'IF'
WHEN (select facilityname from facility) LIKE '%General%Hospital%Ifako%' THEN 'IF'
WHEN (select facilityname from facility) LIKE '%GH%Ikorodu%' THEN 'IK'
WHEN (select facilityname from facility) LIKE '%General%Hospital%Ikorodu%' THEN 'IK'
WHEN (select facilityname from facility) LIKE '%Ifako%Primary%' THEN 'FK'
WHEN (select facilityname from facility) LIKE '%Primary%Health%Care%ifako%' THEN 'FK'
WHEN (select facilityname from facility) LIKE '%Ifako%PHC%' THEN 'FK'
WHEN (select facilityname from facility) LIKE '%Ancilla%' THEN 'AN'
WHEN (select facilityname from facility) LIKE '%GH%Mushin%' THEN 'MU'
WHEN (select facilityname from facility) LIKE '%General%Hospital%Mushin%' THEN 'MU'
WHEN (select facilityname from facility) LIKE '%GH%Epe%' THEN 'EP'
WHEN (select facilityname from facility) LIKE '%General%Hospital%Epe%' THEN 'EP'
WHEN (select facilityname from facility) LIKE '%Ajeabo%' THEN 'JB'
WHEN (select facilityname from facility) LIKE '%Palm%' THEN 'PV'
WHEN (select facilityname from facility) LIKE '%Palm%Avenue%' THEN 'PV'
WHEN (select facilityname from facility) LIKE '%LUTH%' THEN 'LU'
WHEN (select facilityname from facility) LIKE '%Lagos%University%' THEN 'LU'
WHEN (select facilityname from facility) LIKE '%Police%' THEN 'FL'
WHEN (select facilityname from facility) LIKE '%NIMR%' THEN 'NM'
WHEN (select facilityname from facility) LIKE '%Nigerian%Insti%' THEN 'NM'
WHEN (select facilityname from facility) LIKE '%Ibej%' THEN 'IL'
WHEN (select facilityname from facility) LIKE '%University College Hospital%' THEN 'UC'
WHEN (select facilityname from facility) LIKE '%University Collage Hospital%' THEN 'UC'
WHEN (select facilityname from facility) LIKE '%UCH%' THEN 'UC'
WHEN (select facilityname from facility) LIKE '%Adeoyo%' THEN 'AD'
WHEN (select facilityname from facility) LIKE '%State Hospital Ogbomoso%' THEN 'OG'
WHEN (select facilityname from facility) LIKE '%Ogbomoso%' THEN 'OG'
WHEN (select facilityname from facility) LIKE '%St%Mary%' THEN 'EH'
WHEN (select facilityname from facility) LIKE '%Mary%' THEN 'EH'
WHEN (select facilityname from facility) LIKE '%Baptist%Medical%saki%' THEN 'BM'
WHEN (select facilityname from facility) LIKE '%Baptist%Medical%' THEN 'BM'
WHEN (select facilityname from facility) LIKE '%State Hospital Oyo%' THEN 'SY'
WHEN (select facilityname from facility) LIKE '%State Hospital Saki%' THEN 'SK'
WHEN (select facilityname from facility) LIKE '%Bowen%' THEN 'BW'
WHEN (select facilityname from facility) LIKE '%OLA%' THEN 'OL'
WHEN (select facilityname from facility) LIKE '%Our%Lady%' THEN 'OL'
WHEN (select facilityname from facility) LIKE '%Eruwa%' THEN 'ER'
WHEN (select facilityname from facility) LIKE '%Barkin%Ladi%' THEN 'BL'
WHEN (select facilityname from facility) LIKE '%Jos University%' THEN 'JU'
WHEN (select facilityname from facility) LIKE '%Cottage Hospital%' THEN 'KW'
WHEN (select facilityname from facility) LIKE '%Plateau State Specialist%' THEN 'PS'
WHEN (select facilityname from facility) LIKE '%Our Lady of Apostle%' THEN 'OL'
WHEN (select facilityname from facility) LIKE '%Pankshin%General%Hospital%' THEN 'PH'
WHEN (select facilityname from facility) LIKE '%General%Hospital%Pankshin%' THEN 'PH'
WHEN (select facilityname from facility) LIKE '%GH%Pankshin%' THEN 'PH'
WHEN (select facilityname from facility) LIKE '%Pankshin%GH%' THEN 'PH'
WHEN (select facilityname from facility) LIKE '%Panyam%Maternity%' THEN 'PY'
WHEN (select facilityname from facility) LIKE '%Seventh%Day%' THEN 'SD'
WHEN (select facilityname from facility) LIKE '%General%Hospital%Shendam%' THEN 'SH'
WHEN (select facilityname from facility) LIKE '%Shendam%General%Hospital%' THEN 'SH'
WHEN (select facilityname from facility) LIKE '%Shendam%GH%' THEN 'SH'
WHEN (select facilityname from facility) LIKE '%GH%Shendam%' THEN 'SH'
WHEN (select facilityname from facility) LIKE '%Vom%Christian%' THEN 'VH'
WHEN (select facilityname from facility) LIKE '%VCH%' THEN 'VH'
WHEN (select facilityname from facility) LIKE '%Military%' THEN 'MH'
WHEN (select facilityname from facility) LIKE '%JUTH%Comprehensive%' THEN 'ZK'
WHEN (select facilityname from facility) LIKE '%JUTH%' THEN 'JU'
WHEN (select facilityname from facility) LIKE '%Jos%University%Teaching%Hospital%' THEN 'JU'
WHEN (select facilityname from facility) LIKE '%General%Hospital%Mangu%' THEN 'MG'
WHEN (select facilityname from facility) LIKE '%GH%Mangu%' THEN 'MG'
WHEN (select facilityname from facility) LIKE '%Faith%Alive%' THEN 'FA'
WHEN (select facilityname from facility) LIKE '%FAF%' THEN 'FA'
WHEN (select facilityname from facility) LIKE '%COCIN%' THEN 'RC'
WHEN (select facilityname from facility) LIKE '%CH%RC%Mangu%' THEN 'RC'
WHEN (select facilityname from facility) LIKE '%CHRC%Mangu%' THEN 'RC'
WHEN (select facilityname from facility) LIKE '%Church%Mangu%' THEN 'RC'
WHEN (select facilityname from facility) LIKE '%General%Hospital%Langtang%' THEN 'LG'
WHEN (select facilityname from facility) LIKE '%GH%Langtang%' THEN 'LG'
WHEN (select facilityname from facility) LIKE '%Cottage%Hospital%Bassa%' THEN 'BA'
WHEN (select facilityname from facility) LIKE '%Cottage%Hospital%Bokkos%' THEN 'BK'
WHEN (select facilityname from facility) LIKE '%Our%Lady%Apostles%Zawan%' THEN 'ZA'
WHEN (select facilityname from facility) LIKE '%Zawan%' THEN 'ZA'
WHEN (select facilityname from facility) LIKE '%zawan%' THEN 'ZA'
WHEN (select facilityname from facility) LIKE '%Hwolshe%Medical%Centre%' THEN 'HW'
WHEN (select facilityname from facility) LIKE '%Dadinkowa%' THEN 'DK'
WHEN (select facilityname from facility) LIKE '%FMC%' THEN 'FM'
WHEN (select facilityname from facility) LIKE '%University%Maiduguri%' THEN 'UM'
WHEN (select facilityname from facility) LIKE '%UMTH%' THEN 'UM'
WHEN (select facilityname from facility) LIKE '%Nsukka%' THEN 'UN'
WHEN (select facilityname from facility) LIKE '%UNTH%' THEN 'UN'
WHEN (select facilityname from facility) LIKE '%University%Nigeria%Teaching%' THEN 'UN'
WHEN (select facilityname from facility) LIKE '%Virgilus%' THEN 'VC'
WHEN (select facilityname from facility) LIKE '%Bingham%' THEN 'BU'
WHEN (select facilityname from facility) LIKE '%BUTH%' THEN 'BU'
WHEN (select facilityname from facility) LIKE '%CCDP%' THEN 'PY'
WHEN (select facilityname from facility) LIKE '%Plateau%State%' THEN 'PS'
WHEN (select facilityname from facility) LIKE '%PSSH%' THEN 'PS'
WHEN (select facilityname from facility) LIKE '%Ahmadu%' THEN 'AB'
WHEN (select facilityname from facility) LIKE '%ABUTH%' THEN 'AB'
WHEN (select facilityname from facility) LIKE '%Makurdi%' THEN 'FM'
WHEN (select facilityname from facility) LIKE '%Federal%Medical%Center%Makurdi%' THEN 'FM'
WHEN (select facilityname from facility) LIKE '%Nursing%Home%Maiduguri%' THEN 'NH'
WHEN (select facilityname from facility) LIKE '%Nursing%' THEN 'NH'
WHEN (select facilityname from facility) LIKE '%General%Hospital%Ijebu%' THEN 'IJ'
WHEN (select facilityname from facility) LIKE '%GH%Ijebu%' THEN 'IJ'
WHEN (select facilityname from facility) LIKE '%Sacred%Heart%Lantoro%' THEN 'LT'
WHEN (select facilityname from facility) LIKE '%Lantoro%' THEN 'LT'
WHEN (select facilityname from facility) LIKE '%Dadin%Kowa%' THEN 'DK'
WHEN (select facilityname from facility) LIKE '%Womens%Hospital%Onikan%' THEN 'ON'
WHEN (select facilityname from facility) LIKE '%Onikan%' THEN 'ON'
WHEN (select facilityname from facility) LIKE '%Nguru%' THEN 'NU'
WHEN (select facilityname from facility) LIKE '%Federeal%Nguru%' THEN 'NU'
WHEN (select facilityname from facility) LIKE '%General%Tunkus%' THEN 'TK'
WHEN (select facilityname from facility) LIKE '%GH%Tunkus%' THEN 'TK'
WHEN (select facilityname from facility) LIKE '%General%Moniya%' THEN 'MO'
WHEN (select facilityname from facility) LIKE '%GH%Moniya%' THEN 'MO'
WHEN (select facilityname from facility) LIKE '%GH%Angware%' THEN 'AW'
WHEN (select facilityname from facility) LIKE '%General%Angware%' THEN 'AW'
WHEN (select facilityname from facility) LIKE '%GH%Ibeju%' THEN 'IL'
WHEN (select facilityname from facility) LIKE '%General%Ibeju%' THEN 'IL'
WHEN (select facilityname from facility) LIKE '%GH%Isolo%' THEN 'GS'
WHEN (select facilityname from facility) LIKE '%General%Isolo%' THEN 'GS'
WHEN (select facilityname from facility) LIKE '%Angware%' THEN 'AW'
WHEN (select facilityname from facility) LIKE '%Adefemi%Hospital%' THEN 'FH'
WHEN (select facilityname from facility) LIKE '%Agape%Hospital%' THEN 'AG'
WHEN (select facilityname from facility) LIKE '%Comprehensive%Bassa%' THEN 'BA'
WHEN (select facilityname from facility) LIKE '%CHC%Bassa%' THEN 'BA'
WHEN (select facilityname from facility) LIKE '%Comprehensive%Bokkos%' THEN 'BC'
WHEN (select facilityname from facility) LIKE '%CHC%Bokkos%' THEN 'BC'
WHEN (select facilityname from facility) LIKE '%Comprehensive%Dyerok%' THEN 'DY'
WHEN (select facilityname from facility) LIKE '%CHC%Dyerok%' THEN 'DY'
WHEN (select facilityname from facility) LIKE '%Comprehensive%Gindiri%' THEN 'GD'
WHEN (select facilityname from facility) LIKE '%CHC%Gindiri%' THEN 'GD'
WHEN (select facilityname from facility) LIKE '%Comprehensive%Lardang%' THEN 'CL'
WHEN (select facilityname from facility) LIKE '%CHC%Lardang%' THEN 'CL'
WHEN (select facilityname from facility) LIKE '%Comprehensive%Banki%' THEN 'BK'
WHEN (select facilityname from facility) LIKE '%CHC%Banki%' THEN 'BK'
WHEN (select facilityname from facility) LIKE '%Comprehensive%Madagali%' THEN 'MA'
WHEN (select facilityname from facility) LIKE '%CHC%Madagali%' THEN 'MA'
WHEN (select facilityname from facility) LIKE '%General%Quan%' THEN 'QP'
WHEN (select facilityname from facility) LIKE '%General%Quaan%' THEN 'QP'
WHEN (select facilityname from facility) LIKE '%GH%Quan%' THEN 'QP'
WHEN (select facilityname from facility) LIKE '%GH%Quaan%' THEN 'QP'
WHEN (select facilityname from facility) LIKE '%Jericho%Specialist%' THEN 'JH'
WHEN (select facilityname from facility) LIKE '%JSH%' THEN 'JH'
WHEN (select facilityname from facility) LIKE '%Ladoke%Akintola%' THEN 'LD'
WHEN (select facilityname from facility) LIKE '%LAUTECH%' THEN 'LD'
WHEN (select facilityname from facility) LIKE '%May%Clinic%Shendam%' THEN 'MC'
WHEN (select facilityname from facility) LIKE '%May%Clinic%' THEN 'MC'
WHEN (select facilityname from facility) LIKE '%Ring%Road%' THEN 'RS'
WHEN (select facilityname from facility) LIKE '%RRSH%' THEN 'RS'
WHEN (select facilityname from facility) LIKE '%Kizito%Catholic%' THEN 'KZ'
WHEN (select facilityname from facility) LIKE '%Kizito%Clinic%' THEN 'SU'
WHEN (select facilityname from facility) LIKE '%General%Agbowa%' THEN 'GB'
WHEN (select facilityname from facility) LIKE '%GH%Agbowa%' THEN 'GB'
WHEN (select facilityname from facility) LIKE '%General%Shomolu%' THEN 'SG'
WHEN (select facilityname from facility) LIKE '%GH%Shomolu%' THEN 'SG'
WHEN (select facilityname from facility) LIKE '%Lagoon%Hospital%' THEN 'LN'
WHEN (select facilityname from facility) LIKE '%Lagoon%' THEN 'LN'
WHEN (select facilityname from facility) LIKE '%Primary%Agboju%' THEN 'AP'
WHEN (select facilityname from facility) LIKE '%PHC%Agboju%' THEN 'AP'
WHEN (select facilityname from facility) LIKE '%Agboju%Primary%' THEN 'AP'
WHEN (select facilityname from facility) LIKE '%Agboju%PHC%' THEN 'AP'
WHEN (select facilityname from facility) LIKE '%Primary%Aregbesola%' THEN 'RB'
WHEN (select facilityname from facility) LIKE '%PHC%Aregbesola%' THEN 'RB'
WHEN (select facilityname from facility) LIKE '%Aregbesola%Primary%' THEN 'RB'
WHEN (select facilityname from facility) LIKE '%Aregbesola%PHC%' THEN 'RB'
WHEN (select facilityname from facility) LIKE '%Primary%Iru%' THEN 'IR'
WHEN (select facilityname from facility) LIKE '%PHC%Iru%' THEN 'IR'
WHEN (select facilityname from facility) LIKE '%Iru%Primary%' THEN 'IR'
WHEN (select facilityname from facility) LIKE '%Iru%PHC%' THEN 'IR'
WHEN (select facilityname from facility) LIKE '%MCC%Amuwo%' THEN 'MW'
ELSE SUBSTRING(a.pepid,1,2) END AS facn,CASE SUBSTRING(a.pepid,1,2) 
WHEN 'LG' THEN 'LASUTH'
WHEN 'MW' THEN 'MCC Amuwo Odofin'
WHEN 'IR' THEN 'Iru Primary Health Center'
WHEN 'AP' THEN 'Agboju Primary Health Center'
WHEN 'LN' THEN 'Lagoon Hospital'
WHEN 'SG' THEN 'General Hospital Shomolu'
WHEN 'GB' THEN 'General Hospital Agbowa'
WHEN 'GH' THEN 'General Hospital Agbowa'
WHEN 'KZ' THEN 'St Kizito Catholic Clinic'
WHEN 'SU' THEN 'St Kizito Clinic'
WHEN 'RS' THEN 'Ring Road Specialist Hospital'
WHEN 'MC' THEN 'May Clinic Shendam'
WHEN 'LD' THEN 'Ladoke Akintola University of Technology'
WHEN 'JH' THEN 'Jericho Specialist Hospital Ibadan'
WHEN 'BA' THEN 'Comprehensive Health Center Bassa'
WHEN 'BA' THEN 'Comprehensive Health Center Madagali'
WHEN 'BK' THEN 'Comprehensive Health Center Banki'
WHEN 'CL' THEN 'Comprehensive Health Center Lardang'
WHEN 'GD' THEN 'Comprehensive Health Center JUTH Gindiri'
WHEN 'DY' THEN 'Comprehensive Health Center Dyerok'
WHEN 'BC' THEN 'Comprehensive Health Center Bokkos'
WHEN 'TK' THEN 'General Hospital Tunkus'
WHEN 'MO' THEN 'General Hospital Moniya'
WHEN 'QP' THEN 'General Hospital Quan Pan'
WHEN 'IK' THEN 'General Hospital Ikorodu'
WHEN 'EP' THEN 'General Hospital Epe'
WHEN 'FH' THEN 'Adefemi Hospital'
WHEN 'AG' THEN 'Agape Hospital'
WHEN 'AW' THEN 'General Hospital Angware'
WHEN 'GS' THEN 'General Hospital Isolo'
WHEN 'NU' THEN 'Federal Medical Center Nguru'
WHEN 'ON' THEN 'Womens Hospital Onikan'
WHEN 'DK' THEN 'Dadin Kowa Comprehensive Health Center'
WHEN 'LT' THEN 'Sacred Heart Hospital Lantoro'
WHEN 'IJ' THEN 'General Hospital Ijebu-Ode'
WHEN 'NH' THEN 'Nursing Home Maiduguri'
WHEN 'SM' THEN 'State Specialist Hospital Maiduguri'
WHEN 'UM' THEN 'University Of Maiduguri Teaching Hospital'
WHEN 'MH' THEN '68 Military Hospital'
WHEN 'AB' THEN 'Ahmadu Bello Teaching Hospital'
WHEN 'PY' THEN 'CCDP Panyam'
WHEN 'PS' THEN 'Plateau State Hospital'
WHEN 'BU' THEN 'Bingham University Teaching Hospital'
WHEN 'GA' THEN 'GH Alimosho'
WHEN 'RB' THEN 'Rauf Aregbesola PHC'
WHEN 'IP' THEN 'Ipaja PHC'
WHEN 'OJ' THEN 'Ojodu PHC'
WHEN 'IF' THEN 'GH Ifako-Ijaiye'
WHEN 'FK' THEN 'Ifako PHC'
WHEN 'AN' THEN 'Ancilla Hospital'
WHEN 'MU' THEN 'GH Mushin'
WHEN 'JB' THEN 'Ajeabo PHC'
WHEN 'PV' THEN 'Palm Avenue PHC'
WHEN 'LU' THEN 'LUTH'
WHEN 'JU' THEN 'Jos University Teaching Hospital'

WHEN 'FL' THEN 'Police Hospital, Falomo'
WHEN 'NM' THEN 'National Insitute of Medical Research (NIMR)'
WHEN 'IL' THEN 'GH Ibeju-Lekki'

WHEN 'UC' THEN 'University College Hospital'
WHEN 'AD' THEN 'Adeoyo Maternity Hospital'
WHEN 'OG' THEN 'State Hospital Ogbomoso'
WHEN 'EH' THEN 'St. Mary Chatholic Hospital Eleta'
WHEN 'BM' THEN 'Baptist  Medical Centre Saki'
WHEN 'SY' THEN 'State Hospital Oyo'
WHEN 'SK' THEN 'State Hospital Saki'
WHEN 'BW' THEN 'Bowen Teachin Hospital Ogbomoso'
WHEN 'OY' THEN 'OLA Hospital Oluyoro'
WHEN 'ER' THEN 'General Hospital Eruwa'

WHEN 'BL' THEN 'Barkin Ladi General Hospital'
WHEN 'JU' THEN 'Jos University Teaching Hospital'
WHEN 'KW' THEN 'Cottage Hospital, Kwalla'
WHEN 'PS' THEN 'Plateau State Specialist Hospital, Jos'
WHEN 'OL' THEN 'Our Lady of Apostles, Jos'
WHEN 'PK' THEN 'Pankshin General Hospital'
WHEN 'PY' THEN 'Panyam Maternity Hospital'
WHEN 'SD' THEN 'Seventh Day Adventist Hospital, Jengre'
WHEN 'SH' THEN 'General Hospital, Shendam'
WHEN 'SL' THEN 'Solat Women Hospital'
WHEN 'VH' THEN 'Vom Christian Hospital'
WHEN 'ZK' THEN 'JUTH, Comprehensive Health Centre, Zamko'
WHEN 'MG' THEN 'General Hospital, Mangu'
WHEN 'FA' THEN 'Faith Alive Foundation'
WHEN 'RC' THEN 'COCIN Hospital Rehabilitation Centre, Mangu'
WHEN 'LG' THEN 'General Hospital, Langtang'
WHEN 'BA' THEN 'Cottage Hospital, Bassa'
WHEN 'BK' THEN 'Cottage Hospital Bokkos'
WHEN 'ZA' THEN 'Our Lady of Apostles, Zawan'
WHEN 'HW' THEN 'Hwolshe Medical Centre'
WHEN 'DK' THEN 'CHC Dakinkowa'
WHEN 'FM' THEN 'FMC Makurdi'
WHEN 'UM' THEN 'University Of Maiduguri'
WHEN 'UN' THEN 'University Of Nigeria Teaching Hospital'
WHEN 'VC' THEN 'St Virgilus Mangu'

ELSE SUBSTRING(a.pepid,1,2) END AS diagfac,uniqueid as IDNumber,dob as PatientDateOfBirth,substring(upper(sex),1,1) as PatientSexCode,CASE lower(patientdied) WHEN 'art' THEN 'true' WHEN 'pre-art' THEN 'true' ELSE 'false' END as PatientDeceasedIndicator,CASE educationallevel WHEN 'None' THEN 1 WHEN 'Quranic' THEN 4 WHEN 'Primary' THEN 2 WHEN 'Junior Secondary' THEN 5 WHEN 'Senior Secondary' THEN 3 WHEN 'Post Secondary' THEN 6 ELSE 7 END as PatientEducationLevelCode,CASE jobstatus WHEN 'Unemployed' THEN 'UNE' WHEN 'Student' THEN 'STU' WHEN 'Employed' THEN 'EMP' WHEN 'Retired' THEN 'RET' ELSE 'UNK' END as PatientOccupationCode,CASE maritalstatus WHEN 'Single' THEN 'S' WHEN 'Widowed' THEN 'W' WHEN 'Married' THEN 'M' WHEN 'Separated' THEN 'A' WHEN 'Divorced' THEN 'D' ELSE 'U' END as PatientMaritalStatusCode,CASE  
WHEN whostagecriteria LIKE '%Asymptomatic%' THEN '236704009' 
WHEN whostagecriteria LIKE '%Persistent Lymphadenopathy%' THEN '95892003' 
WHEN whostagecriteria LIKE '%Minor Mucocutaneous Manifestations%' THEN '29147005' 
WHEN whostagecriteria LIKE '%Herpes Zoster%' THEN '4740000' 
WHEN whostagecriteria LIKE '%Recurrent Upper Respiratory Tract Infections%' THEN '195708003' 
WHEN whostagecriteria LIKE '%Unexplained Chronic Diarrhea%' THEN '86615009' 
WHEN whostagecriteria LIKE '%Unexplained Prolonged Fever%' THEN '409553007' 
WHEN whostagecriteria LIKE '%Oral Candidiasis%' THEN '79740000' 
WHEN whostagecriteria LIKE '%Oral Hairy Leukoplakia%' THEN '235032001' 
WHEN whostagecriteria LIKE '%TB, Pulmonary%' THEN '154283005' 
WHEN whostagecriteria LIKE '%Severe Bacterial Infections%' THEN '428875002' 
WHEN whostagecriteria LIKE '%PCP%' THEN '75549005' 
WHEN whostagecriteria LIKE '%Toxoplasmosis, CNS%' THEN '187192000' 
WHEN whostagecriteria LIKE '%Cryptosporidiosis with Diarrhea%' THEN '240370009' 
WHEN whostagecriteria LIKE '%Cryptococcosis, Extrapulmonary%' THEN '20953001' 
WHEN whostagecriteria LIKE '%Cytomegalovirus disease%' THEN '28944009' 
WHEN whostagecriteria LIKE '%Herpes Simplex%' THEN '88594005' 
WHEN whostagecriteria LIKE '%Progressive Multifocal Leukoencephalopathy%' THEN '22255007' 
WHEN whostagecriteria LIKE '%Mycosis, disseminated%' THEN '402138008' 
WHEN whostagecriteria LIKE '%Candidiasis%' THEN '78048006' 
WHEN whostagecriteria LIKE '%Atypical Mycobacteriosis, disseminated%' THEN '88415009' 
WHEN whostagecriteria LIKE '%Oral Candidiasis%' THEN '79740000' 
ELSE '' 
END as ConditionCode,WardVillage, town,CASE  
WHEN lower(state) LIKE '%abia%' THEN '1' 
WHEN lower(state) LIKE '%adamawa%' THEN '2' 
WHEN lower(state) LIKE '%akwaibom%' THEN '3' 
WHEN lower(state) LIKE '%anambra%' THEN '4' 
WHEN lower(state) LIKE '%bauchi%' THEN '5' 
WHEN lower(state) LIKE '%benue%' THEN '6' 
WHEN lower(state) LIKE '%bayelsa%' THEN '7' 
WHEN lower(state) LIKE '%borno%' THEN '8' 
WHEN lower(state) LIKE '%cross%' THEN '9' 
WHEN lower(state) LIKE '%delta%' THEN '10' 
WHEN lower(state) LIKE '%ebonyi%' THEN '11' 
WHEN lower(state) LIKE '%edo%' THEN '12' 
WHEN lower(state) LIKE '%ekiti%' THEN '13' 
WHEN lower(state) LIKE '%enugu%' THEN '14' 
WHEN lower(state) LIKE '%fct%' THEN '15' 
WHEN lower(state) LIKE '%abuja%' THEN '15' 
WHEN lower(state) LIKE '%gombe%' THEN '16' 
WHEN lower(state) LIKE '%imo%' THEN '17' 
WHEN lower(state) LIKE '%jigawa%' THEN '18' 
WHEN lower(state) LIKE '%kaduna%' THEN '19' 
WHEN lower(state) LIKE '%kano%' THEN '20' 
WHEN lower(state) LIKE '%katsina%' THEN '21' 
WHEN lower(state) LIKE '%kebbi%' THEN '22' 
WHEN lower(state) LIKE '%kogi%' THEN '23' 
WHEN lower(state) LIKE '%kwara%' THEN '24' 
WHEN lower(state) LIKE '%lagos%' THEN '25' 
WHEN lower(state) LIKE '%nasarawa%' THEN '26' 
WHEN lower(state) LIKE '%niger%' THEN '27' 
WHEN lower(state) LIKE '%ogun%' THEN '28' 
WHEN lower(state) LIKE '%ondo%' THEN '29' 
WHEN lower(state) LIKE '%osun%' THEN '30' 
WHEN lower(state) LIKE '%oyo%' THEN '31' 
WHEN lower(state) LIKE '%plateau%' THEN '32' 
WHEN lower(state) LIKE '%rivers%' THEN '33' 
WHEN lower(state) LIKE '%sokoto%' THEN '34' 
WHEN lower(state) LIKE '%taraba%' THEN '35' 
WHEN lower(state) LIKE '%yobe%' THEN '36' 
WHEN lower(state) LIKE '%zamfara%' THEN '37' 
ELSE '' 
END as state,hospitalid as HospitalNumber, enroldate as DateOfFirstReport,enroldate as DiagnosisDate,age as PatientAge,CASE serviceentry 
WHEN 'STI' THEN 1 
WHEN 'OPD' THEN 2 
WHEN 'HCT' THEN 3 
WHEN 'Private' THEN 5 
WHEN 'TB' THEN 6 
WHEN 'Ward' THEN 7 
WHEN 'Casualty' THEN 8 
WHEN 'ANC/PMTCT' THEN 9 
WHEN 'Current Clinic Patient' THEN 12 
WHEN 'Self Referral' THEN 13  
ELSE '' END as CareEntryPoint,CASE WHEN hivposdate='0000-00-00' OR hivposdate IS NULL THEN DATE_SUB(enroldate, INTERVAL 7 DAY) ELSE hivposdate END as FirstConfirmedHIVTestDate,CASE WHEN lower(hivmode) LIKE '%ab%' THEN 'HIVAb'
WHEN lower(hivmode) LIKE '%pcr%' THEN 'HIVPCR'
ELSE '' END as FirstHIVTestMode,testlocation as WhereFirstHIVTest, CASE priorart 
WHEN 'Transfer in with records' THEN 'T' 
WHEN 'Earlier ARV but not a transfer in' THEN 'NT'
WHEN 'PMTCT only' THEN 'P' 
WHEN 'None' THEN 'N' 
ELSE '' END as PriorArt,dateeligible as MedicallyEligibleDate,CASE whyeligible 
WHEN 'CD4' THEN '2' 
WHEN 'TLC' THEN '4' 
WHEN 'Clinically only' THEN '1'
ELSE '' END as ReasonMedicallyEligible,dateinitadh as InitialAdherenceCounselingCompletedDate,CASE firstartregimen 
WHEN 'AZT/3TC/EFV' THEN '1a' 
WHEN 'AZT/3TC/NVP' THEN '1b' 
WHEN 'TDF/FTC/EFV' THEN '1c' 
WHEN 'TDF/FTC/NVP' THEN '1d' 
WHEN 'TDF/3TC/EFV' THEN '1e' 
WHEN 'TDF/3TC/NVP' THEN '1f' 
WHEN 'AZT/3TC/ABC' THEN '1g' 
WHEN 'AZT/3TC/TDF' THEN '1h' 
WHEN 'TDF/FTC/LPV/r' THEN '2a' 
WHEN 'TDF/3TC/LPV/r' THEN '2b' 
WHEN 'TDF/FTC/ATV/r' THEN '2c' 
WHEN 'TDF/3TC/ATV/r' THEN '2d' 
WHEN 'AZT/3TC/LPV/r' THEN '2e' 
WHEN 'AZT/3TC/ATV/r' THEN '2f' 
WHEN 'TLC' THEN '4' 

ELSE '' END as Code,CASE firstartregimen 
WHEN 'AZT/3TC/EFV' THEN 'AZT-3TC-EFV' 
WHEN 'AZT/3TC/NVP' THEN 'AZT-3TC-NVP' 
WHEN 'TDF/FTC/EFV' THEN 'TDF-FTC-EFV' 
WHEN 'TDF/FTC/NVP' THEN 'TDF-FTC-NVP' 
WHEN 'TDF/3TC/EFV' THEN 'TDF-3TC-EFV' 
WHEN 'TDF/3TC/NVP' THEN 'TDF-3TC-NVP' 
WHEN 'AZT/3TC/ABC' THEN 'AZT-3TC-ABC' 
WHEN 'AZT/3TC/TDF' THEN 'AZT-3TC-TDF' 
WHEN 'TDF/FTC/LPV/r' THEN 'TDF-FTC-LPV/r' 
WHEN 'TDF/3TC/LPV/r' THEN 'TDF-3TC-LPV/r' 
WHEN 'TDF/FTC/ATV/r' THEN 'TDF-FTC-ATV/r' 
WHEN 'TDF/3TC/ATV/r' THEN 'TDF-3TC-ATV/r' 
WHEN 'AZT/3TC/LPV/r' THEN 'AZT-3TC-LPV/r' 
WHEN 'AZT/3TC/ATV/r' THEN 'AZT-3TC-ATV/r' 
ELSE '' END as CodeDescTxt,CASE b.regimen
WHEN 'AZT-3TC-EFV' THEN '1a' 
WHEN 'AZT-3TC-NVP' THEN '1b' 
WHEN 'TDF-FTC-EFV' THEN '1c' 
WHEN 'TDF-FTC-NVP' THEN '1d' 
WHEN 'TDF-3TC-EFV' THEN '1e' 
WHEN 'TDF-3TC-NVP' THEN '1f' 
WHEN 'AZT-3TC-ABC' THEN '1g' 
WHEN 'AZT-3TC-TDF' THEN '1h' 
WHEN 'TDF-FTC-LPV/r' THEN '2a' 
WHEN 'TDF-3TC-LPV/r' THEN '2b' 
WHEN 'TDF-FTC-ATV/r' THEN '2c' 
WHEN 'TDF-3TC-ATV/r' THEN '2d' 
WHEN 'AZT-3TC-LPV/r' THEN '2e' 
WHEN 'AZT-3TC-ATV/r' THEN '2f' 
WHEN 'TLC' THEN '4' 

ELSE '' END as CodeRegEnc,b.regimen as CodeDescTxtRegEnc,dateartstart AS ARTStartDate,clinicalstageart as WHOClinicalStageARTStart,ROUND(peweightatart) as WeightAtARTStart,CASE patfunction 
WHEN 'Working' THEN 'W' 
WHEN 'Ambulant' THEN 'A' 
WHEN 'Bedridden' THEN 'B' 
ELSE '' END as FunctionalStatusStartART,cd4atart as CD4AtStartOfART,enroldate as EnrolledInHIVCareDate,CASE b.tbstatus 
WHEN 'No Signs' THEN '1' 
WHEN 'TB Suspected and referred for evaluation' THEN '2' 
WHEN 'On INH prophylaxis' THEN '3' 
WHEN 'Currently on TB treatment' THEN '4' 
WHEN 'TB positive, Not on drugs' THEN '5' 
ELSE '' END as InitialTBStatus,b.clinicevalid as VisitIDEnc,b.visitdate as VisitDateEnc,CASE b.artduration 
WHEN '' THEN 0
WHEN '2/12' THEN 2
WHEN '3/12' THEN 3
WHEN '1/12' THEN 1
WHEN '2/52' THEN 0.5
WHEN '1/52' THEN 0.25
ELSE b.artduration END as DurationOnArt,ROUND(b.weight) as Weight,b.bp as BloodPressure,CASE b.fp 
WHEN 'Condoms' THEN 'FP1' 
WHEN 'Oral contraceptive pills' THEN 'FP2' 
WHEN 'Injectable/Implantable hormones' THEN 'FP3' 
WHEN 'Diaphragm/cervical caps' THEN 'FP4' 
WHEN 'Intra uterine device' THEN 'FP5' 
WHEN 'Vasectomy/tubal ligation/hysterectomy' THEN 'FP6' 
WHEN 'Other' THEN 'FP7' 
WHEN 'Not on family planning' THEN 'NOFP'
ELSE '' END as PatientFamilyPlanningMethodCode,CASE b.functionalstatus 
WHEN 'Working' THEN 'W' 
WHEN 'Ambulant' THEN 'A' 
WHEN 'Bedridden' THEN 'B' 
ELSE '' END as FunctionalStatus,b.whostage AS WHOClinicalStage,CASE b.tbstatus 
WHEN 'No Signs' THEN '1' 
WHEN 'TB Suspected and referred for evaluation' THEN '2' 
WHEN 'On INH prophylaxis' THEN '3' 
WHEN 'Currently on TB treatment' THEN '4' 
WHEN 'TB positive, Not on drugs' THEN 'B' 
ELSE '' END as TBStatus,CASE  
WHEN b.cotrimdose like '%480%' THEN 'CTX480' 
WHEN b.cotrimdose like '%960%' THEN 'CTX960' 
ELSE '' END as CodeCTX,CASE  
WHEN b.cotrimdose like '%480%' THEN 'Cotrimoxazole 480mg' 
WHEN b.cotrimdose like '%960%' THEN 'Cotrimoxazole 960mg' 
ELSE '' END as CodeDescTxtCTX,CASE  
WHEN d.oiqty like '%100%' AND d.oidrug like '%CTX%' THEN 'CTX100' 
WHEN d.oiqty like '%200%' AND d.oidrug like '%CTX%' THEN 'CTX200' 
WHEN d.oiqty like '%300%' AND d.oidrug like '%CTX%' THEN 'CTX300' 
WHEN d.oiqty like '%480%' AND d.oidrug like '%CTX%' THEN 'CTX480' 
WHEN d.oiqty like '%960%' AND d.oidrug like '%CTX%' THEN 'CTX960' 
ELSE '' END as CodeCTXPharm,CASE  
WHEN d.oiqty like '%100%' AND d.oidrug like '%CTX%' THEN 'Cotrimoxazole 100mg' 
WHEN d.oiqty like '%200%' AND d.oidrug like '%CTX%' THEN 'Cotrimoxazole 200mg' 
WHEN d.oiqty like '%300%' AND d.oidrug like '%CTX%' THEN 'Cotrimoxazole 300mg' 
WHEN d.oiqty like '%480%' AND d.oidrug like '%CTX%' THEN 'Cotrimoxazole 480mg' 
WHEN d.oiqty like '%960%' AND d.oidrug like '%CTX%' THEN 'Cotrimoxazole 960mg' 
ELSE '' END as CodeDescTxtCTXPharm,c.labid as VisitID,c.VisitDate as VisitDate,c.reportdate as CollectionDate,CASE c.baselineorrepeat 
WHEN 'Baseline' THEN 'B' 
WHEN 'Repeat' THEN 'R' 
ELSE '' END as BaselineRepeatCode,CASE c.artstatus 
WHEN 'ART' THEN 'A' 
WHEN 'Non-ART' THEN 'N' 
ELSE '' END as ARTStatusCode,results as Value1,c.clinicianname as Clinician,c.reportedby as ReportedBy,c.CheckedBy as checkedby,d.pharmacyid as VisitIDpharm,d.visitdate as VisitDatepharm,CASE drugname1 
WHEN 'AZT/3TC/EFV' THEN '1a' 
WHEN 'AZT/3TC/NVP' THEN '1b' 
WHEN 'TDF/FTC/EFV' THEN '1c' 
WHEN 'TDF/FTC/NVP' THEN '1d' 
WHEN 'TDF/3TC/EFV' THEN '1e' 
WHEN 'TDF/3TC/NVP' THEN '1f' 
WHEN 'AZT/3TC/ABC' THEN '1g' 
WHEN 'AZT/3TC/TDF' THEN '1h' 
WHEN 'TDF/FTC/LPV/r' THEN '2a' 
WHEN 'TDF/3TC/LPV/r' THEN '2b' 
WHEN 'TDF/FTC/ATV/r' THEN '2c' 
WHEN 'TDF/3TC/ATV/r' THEN '2d' 
WHEN 'AZT/3TC/LPV/r' THEN '2e' 
WHEN 'AZT/3TC/ATV/r' THEN '2f' 
WHEN 'ABC/3TC/NVP' THEN '4d' 
WHEN 'ABC/3TC/EFV' THEN '4c' 
WHEN 'd4T/3TC/NVP' THEN '4d'
WHEN 'ABC/3TC/LPV/r' THEN '5a'
WHEN 'd4T/3TC/LPV/r' THEN '5c'
WHEN 'ddi/3TC/NVP' THEN '5d'
WHEN 'ABC/3TC/ddi' THEN '5e'
WHEN 'TLC' THEN '4' 
ELSE '' END as CodePharmDrgName1,CASE d.drugname1 
WHEN 'AZT/3TC/EFV' THEN 'AZT-3TC-EFV' 
WHEN 'AZT/3TC/NVP' THEN 'AZT-3TC-NVP' 
WHEN 'TDF/FTC/EFV' THEN 'TDF-FTC-EFV' 
WHEN 'TDF/FTC/NVP' THEN 'TDF-FTC-NVP' 
WHEN 'TDF/3TC/EFV' THEN 'TDF-3TC-EFV' 
WHEN 'TDF/3TC/NVP' THEN 'TDF-3TC-NVP' 
WHEN 'AZT/3TC/ABC' THEN 'AZT-3TC-ABC' 
WHEN 'AZT/3TC/TDF' THEN 'AZT-3TC-TDF' 
WHEN 'ABC/3TC/NVP' THEN 'ABC-3TC-NVP' 
WHEN 'ABC/3TC/EFV' THEN 'ABC-3TC-EFV' 
WHEN 'd4T/3TC/NVP' THEN 'd4T-3TC-NVP'
WHEN 'ABC/3TC/LPV/r' THEN 'ABC-3TC-LPV/r'
WHEN 'd4T/3TC/LPV/r' THEN 'd4T-3TC-LPV/r'
WHEN 'ddi/3TC/NVP' THEN 'ddi-3TC-NVP'
WHEN 'ABC/3TC/ddi' THEN 'ABC-3TC-ddi'
WHEN 'TDF/FTC/LPV/r' THEN 'TDF-FTC-LPV/r' 
WHEN 'TDF/3TC/LPV/r' THEN 'TDF-3TC-LPV/r' 
WHEN 'TDF/FTC/ATV/r' THEN 'TDF-FTC-ATV/r' 
WHEN 'TDF/3TC/ATV/r' THEN 'TDF-3TC-ATV/r' 
WHEN 'AZT/3TC/LPV/r' THEN 'AZT-3TC-LPV/r' 
WHEN 'AZT/3TC/ATV/r' THEN 'AZT-3TC-ATV/r' 
ELSE '' END as CodeDescTxtPharmDrgName1,d.dispensedate as PrescribedRegimenDispensedDate,CASE  
WHEN (d.oidrug like '%CTX%' AND d.oiqty='480mg') THEN 'CTX480' 
WHEN (d.oidrug like '%CTX%' AND d.oiqty='960mg') THEN 'CTX960' 
ELSE '' END AS Code_oi,CASE  
WHEN (d.oidrug like '%CTX%' AND d.oiqty='480mg') THEN 'Cotrimoxazole 480mg' 
WHEN (d.oidrug like '%CTX%' AND d.oiqty='960mg') THEN 'Cotrimoxazole 960mg' 
ELSE '' END AS CodeDescTxt_OI,b.nextapptdate as NextAppointmentDate,CASE d.drugname1 
WHEN 'AZT/3TC/EFV' THEN '10' 
WHEN 'AZT/3TC/NVP' THEN '10' 
WHEN 'TDF/FTC/EFV' THEN '10' 
WHEN 'TDF/FTC/NVP' THEN '10' 
WHEN 'TDF/3TC/EFV' THEN '10' 
WHEN 'TDF/3TC/NVP' THEN '10' 
WHEN 'AZT/3TC/EFV' THEN '10' 
WHEN 'AZT/3TC/NVP' THEN '10' 
WHEN 'ABC/3TC/EFV' THEN '10'
WHEN 'AZT/3TC/ABC' THEN '11'
WHEN 'AZT/3TC/TDF' THEN '11'
WHEN 'ABC/3TC/NVP' THEN '11'
WHEN 'AZT/3TC/ABC' THEN '11'
WHEN 'ABC/3TC/EFV' THEN '11'
WHEN 'ABC/3TC/EFV' THEN '11'
WHEN 'TDF/FTC/LPV/r' THEN '20'
WHEN 'TDF/3TC/LPV/r' THEN '20'
WHEN 'TDF/FTC/ATV/r' THEN '20'
WHEN 'TDF/3TC/ATV/r' THEN '20'
WHEN 'AZT/3TC/LPV/r' THEN '20'
WHEN 'AZT/3TC/ATV/r' THEN '20'
WHEN 'ABC/3TC/LPV/r' THEN '20'
WHEN 'AZT/3TC/LPV/r' THEN '20' 
WHEN 'd4T/3TC/LPV/r' THEN '20' 
WHEN 'ddi/3TC/NVP' THEN '20' 
WHEN 'ABC/3TC/ddi' THEN '20' 
WHEN 'DAR' THEN '30' 
WHEN 'RAL' THEN '30' 
WHEN 'ETR' THEN '30' 
WHEN 'RTV' THEN '30' 
ELSE '' END as PrescribedRegimenLineCode,d.regduration1 as PrescribedRegimenDuration,CASE d.oiduration 
WHEN '1 month' THEN '30' 
WHEN '2 month' THEN '60' 
WHEN '3 month' THEN '90' 
WHEN '4 month' THEN '120' 
ELSE '' END as PrescribedRegimenDurationCTXpharm,CASE d.tbduration 
WHEN '1 month' THEN '30' 
WHEN '2 month' THEN '60' 
WHEN '3 month' THEN '90' 
WHEN '4 month' THEN '120' 
ELSE '' END as PrescribedRegimenDurationTBpharm,b.cd4value as cd4value,b.visitdate as CD4TestDate,CASE  
WHEN d.tbdrug LIKE '%INH%' and d.tbdrug LIKE '%Rifampicin%' AND d.tbdrug LIKE '%PZI%' AND d.tbdrug LIKE '%Streptomycin Injection%' AND d.tbdrug LIKE '%Ethambutol%' THEN 'HRZES'
WHEN d.tbdrug LIKE '%INH%' and d.tbdrug LIKE '%Rifampicin%' AND d.tbdrug LIKE '%PZI%' AND d.tbdrug LIKE '%Ethambutol%' THEN 'HRZE' 
WHEN d.tbdrug LIKE '%INH%' and d.tbdrug LIKE '%Rifampicin%' AND d.tbdrug LIKE '%Ethambutol%' THEN 'HRE' 
WHEN d.tbdrug LIKE '%INH%' and d.tbdrug LIKE '%Rifampicin%' AND d.tbdrug LIKE '%Streptomycin Injection%' THEN 'HRS' 
WHEN d.tbdrug LIKE '%INH%' and d.tbdrug LIKE '%Rifampicin%' THEN 'HR' 
WHEN d.tbdrug LIKE '%INH%' AND d.tbdrug LIKE '%Ethambutol%' THEN 'HE' 
WHEN d.tbdrug LIKE '%Streptomycin Injection%' THEN 'S' 
WHEN d.tbdrug LIKE '%PZI%' THEN 'Z' 
WHEN d.tbdrug LIKE '%Ethambutol%' THEN 'E' 
WHEN d.tbdrug LIKE '%Rifampicin%' THEN 'R' 
WHEN d.tbdrug LIKE '%INH%' THEN 'H'  
ELSE '' END as tbdrugcode,d.tbdrug as tbdrug,c.labregno as LaboratoryTestIdentifier
from patient a LEFT JOIN (select * from clinicaleval where pepid='$_POST[pepid]' order by visitdate DESC LIMIT 1) b
ON (a.pepid=b.pepid)
LEFT JOIN (select * from laboratory where pepid='$_POST[pepid]' and tests='CD4' order by visitdate DESC LIMIT 1) c
ON (a.pepid=c.pepid)
LEFT JOIN (select * from pharmacy where pepid='$_POST[pepid]' order by visitdate DESC LIMIT 1) d
ON (a.pepid=d.pepid)
where a.pepid='$_POST[pepid]'";

		include './mandate_/lidhX.php';

        $resultndr = mysqli_query($con,$query);
        $infondr = mysqli_fetch_assoc($resultndr);
        return $infondr;
    }
}
$classndr = new MyClassndr;
$infondr = $classndr->GetUserInformation();
echo mysql_error();

try 
{ 
        /*** a new dom object ***/ 
    $dom = new domDocument; 

    /*** make the output tidy ***/ 
    $dom->formatOutput = true; 

    /*** create the root element ***/ 
    $root = $dom->appendChild($dom->createElement( "Container" )); 

    /*** create the simple xml element ***/ 
    $Container = simplexml_import_dom( $dom ); 
	

    /*** add a MessageHeader element ***/ 
	$MessageHeader = $Container->addChild("MessageHeader"); 
	$MessageHeader->addChild("MessageStatusCode", "INITIAL"); 
    $MessageHeader->addChild("MessageCreationDateTime", date('Y-m-d\TH:i:s')); 
    $MessageHeader->addChild("MessageSchemaVersion", "1.2"); 
	$MessageHeader->addChild("MessageUniqueID", date('YmdHis')); 
	
	/*** add a MessageSendingOrganization element ***/
	$MessageSendingOrganization = $MessageHeader->addChild("MessageSendingOrganization"); 
	$MessageSendingOrganization->addChild("FacilityName", "AIDS Prevention Initiative In Nigeria"); 
    $MessageSendingOrganization->addChild("FacilityID",  "APIN"); 
    $MessageSendingOrganization->addChild("FacilityTypeCode", "IP"); 
    
	/*** add a IndividualReport element ***/ 
	$IndividualReport = $Container->addChild("IndividualReport"); 
	
	/////////////////////////////////////////////////////////////Start Patient Demographics//////////////////////////////////// 
	$PatientDemographics = $IndividualReport->addChild("PatientDemographics"); 
	
	///// add patientidentifer//////////////////
	$PatientDemographics->addChild("PatientIdentifier", $infondr['PatientIdentifier']); 
	/////////add treatment facility
	$TreatmentFacility = $PatientDemographics->addChild("TreatmentFacility");
	$TreatmentFacility->addChild("FacilityName", $infondr['FacilityName']);
	$TreatmentFacility->addChild("FacilityID", $infondr['facn']);
	$TreatmentFacility->addChild("FacilityTypeCode", "FAC");
	///////////////////add OtherPatientIdentifiers //////////////////////////
	$OtherPatientIdentifiers = $PatientDemographics->addChild("OtherPatientIdentifiers");
	$Identifier = $OtherPatientIdentifiers->addChild("Identifier");
	$Identifier->addChild("IDNumber", $infondr['IDNumber']);
	$Identifier->addChild("IDTypeCode", "PN");
	if($infondr['PatientDateOfBirth']=='0000-00-00'){
	//$PatientDemographics->addChild("PatientDateOfBirth", $infondr['PatientDateOfBirth']);
	}
	else{
	$PatientDemographics->addChild("PatientDateOfBirth", $infondr['PatientDateOfBirth']);
	}
	$PatientDemographics->addChild("PatientSexCode", $infondr['PatientSexCode']);
	$PatientDemographics->addChild("PatientDeceasedIndicator", $infondr['PatientDeceasedIndicator']);
	//$PatientDemographics->addChild("PatientPrimaryLanguageCode", "");
	$PatientDemographics->addChild("PatientEducationLevelCode", $infondr['PatientEducationLevelCode']);
	$PatientDemographics->addChild("PatientOccupationCode", $infondr['PatientOccupationCode']);
	$PatientDemographics->addChild("PatientMaritalStatusCode", $infondr['PatientMaritalStatusCode']);
	$PatientDemographics->addChild("StateOfNigeriaOriginCode", $infondr['state']);
	
	/////////////////////////////////////////////////////////////End Patient Demographics//////////////////////////////////// 
	
	/////////////////////////////////////////////////////////////Start Condition//////////////////////////////////// 
	$Condition = $IndividualReport->addChild("Condition"); 
	$Condition->addChild("ConditionCode", $infondr['ConditionCode']);
	////// add program area //////
	$ProgramArea = $Condition->addChild("ProgramArea"); 
	$ProgramArea->addChild("ProgramAreaCode", "HIV");
	///////////////// add patient address //////////////////
	$PatientAddress = $Condition->addChild("PatientAddress"); 
	$PatientAddress->addChild("AddressTypeCode", "H");
	$PatientAddress->addChild("WardVillage", $infondr['WardVillage']);
	$PatientAddress->addChild("Town", $infondr['town']);
	$PatientAddress->addChild("LGACode", "236");
	$PatientAddress->addChild("StateCode", $infondr['state']);
	$PatientAddress->addChild("CountryCode", "NGA");
	$PatientAddress->addChild("PostalCode", "");
	$PatientAddress->addChild("OtherAddressInformation", "");
	
	/////// add CommonQuestions ///////
	$CommonQuestions = $Condition->addChild("CommonQuestions"); 
	$CommonQuestions->addChild("HospitalNumber", $infondr['HospitalNumber']);
	$DiagnosisFacility = $CommonQuestions->addChild("DiagnosisFacility"); 
	$DiagnosisFacility->addChild("FacilityName", $infondr['diagfac']);
	$DiagnosisFacility->addChild("FacilityID", substr($infondr['pepid'],0,2));
	$DiagnosisFacility->addChild("FacilityTypeCode", "FAC");
	if($infondr['DateOfFirstReport']=='0000-00-00'){
	//$CommonQuestions->addChild("DateOfFirstReport",  $infondr['DateOfFirstReport']);
	//$CommonQuestions->addChild("DiagnosisDate", $infondr['DateOfFirstReport']);
	}
	else{
	$CommonQuestions->addChild("DateOfFirstReport",  $infondr['DateOfFirstReport']);
	$CommonQuestions->addChild("DiagnosisDate", $infondr['DateOfFirstReport']);
	}
	//$CommonQuestions->addChild("DateOfLastReport", "");
	$CommonQuestions->addChild("PatientDieFromThisIllness",  $infondr['PatientDeceasedIndicator']);
	$CommonQuestions->addChild("PatientAge", $infondr['PatientAge']);
	
	/////// add ConditionSpecificQuestions ///////
	$ConditionSpecificQuestions = $Condition->addChild("ConditionSpecificQuestions");
	$HIVQuestions = $ConditionSpecificQuestions->addChild("HIVQuestions");
	if($infondr['CareEntryPoint']==''){
		//$HIVQuestions->addChild("CareEntryPoint", $infondr['CareEntryPoint']);
	}
	else{
		$HIVQuestions->addChild("CareEntryPoint", $infondr['CareEntryPoint']);
	}
	if($infondr['FirstConfirmedHIVTestDate']=='0000-00-00'){
	//$HIVQuestions->addChild("FirstConfirmedHIVTestDate", $infondr['FirstConfirmedHIVTestDate']);
	}
	else{
	$HIVQuestions->addChild("FirstConfirmedHIVTestDate", $infondr['FirstConfirmedHIVTestDate']);
	}
	if ($infondr['FirstHIVTestMode']==''){
		//$HIVQuestions->addChild("FirstHIVTestMode", $infondr['FirstHIVTestMode']);
	}
	else{
		$HIVQuestions->addChild("FirstHIVTestMode", $infondr['FirstHIVTestMode']);
	}
	$HIVQuestions->addChild("WhereFirstHIVTest", $infondr['WhereFirstHIVTest']);
	$HIVQuestions->addChild("PriorArt", $infondr['PriorArt']);
	if($infondr['MedicallyEligibleDate']=='0000-00-00'||$infondr['MedicallyEligibleDate']==''){
		//$HIVQuestions->addChild("MedicallyEligibleDate", $infondr['MedicallyEligibleDate']);
	}
	else{
		$HIVQuestions->addChild("MedicallyEligibleDate", $infondr['MedicallyEligibleDate']);
	}
	if($infondr['ReasonMedicallyEligible']==''){
		//$HIVQuestions->addChild("ReasonMedicallyEligible", $infondr['ReasonMedicallyEligible']);
	}else{
		$HIVQuestions->addChild("ReasonMedicallyEligible", $infondr['ReasonMedicallyEligible']);
	}
	if($infondr['InitialAdherenceCounselingCompletedDate']=='0000-00-00'||$infondr['InitialAdherenceCounselingCompletedDate']==''){
		//$HIVQuestions->addChild("InitialAdherenceCounselingCompletedDate", $infondr['InitialAdherenceCounselingCompletedDate']);
	}else{
		$HIVQuestions->addChild("InitialAdherenceCounselingCompletedDate", $infondr['InitialAdherenceCounselingCompletedDate']);
	}
	
	///// add first art regime //////
	$FirstARTRegimen = $HIVQuestions->addChild("FirstARTRegimen");
	$FirstARTRegimen->addChild("Code", $infondr['Code']);
	$FirstARTRegimen->addChild("CodeDescTxt", $infondr['CodeDescTxt']);
	if($infondr['ARTStartDate']=='0000-00-00'||$infondr['ARTStartDate']==''){
		//$HIVQuestions->addChild("ARTStartDate", $infondr['ARTStartDate']);
	}else{
		$HIVQuestions->addChild("ARTStartDate", $infondr['ARTStartDate']);
	}
	if($infondr['WHOClinicalStageARTStart']==''||$infondr['WHOClinicalStageARTStart']=='0'){
		//$HIVQuestions->addChild("WHOClinicalStageARTStart", $infondr['WHOClinicalStageARTStart']);
	}else{
		$HIVQuestions->addChild("WHOClinicalStageARTStart", $infondr['WHOClinicalStageARTStart']);
	}
	if($infondr['WeightAtARTStart']=='0'||$infondr['WeightAtARTStart']==''){
		//$HIVQuestions->addChild("WeightAtARTStart", $infondr['WeightAtARTStart']);
	}else{
			$HIVQuestions->addChild("WeightAtARTStart", $infondr['WeightAtARTStart']);
	}
	if($infondr['FunctionalStatusStartART']==''){
		//$HIVQuestions->addChild("FunctionalStatusStartART", $infondr['FunctionalStatusStartART']);
	}else{
		$HIVQuestions->addChild("FunctionalStatusStartART", $infondr['FunctionalStatusStartART']);
	}
	if($infondr['CD4AtStartOfART']=='0'){
	//$HIVQuestions->addChild("CD4AtStartOfART", $infondr['CD4AtStartOfART']);
	}
	else{
	$HIVQuestions->addChild("CD4AtStartOfART", $infondr['CD4AtStartOfART']);
	}
	$HIVQuestions->addChild("PatientHasDied", $infondr['PatientDeceasedIndicator']);
	if($infondr['EnrolledInHIVCareDate']=='0000-00-00'){
	//$HIVQuestions->addChild("EnrolledInHIVCareDate", $infondr['EnrolledInHIVCareDate']);
	}
	else{
	$HIVQuestions->addChild("EnrolledInHIVCareDate", $infondr['EnrolledInHIVCareDate']);
	}
	if($infondr['InitialTBStatus']==''){
		//$HIVQuestions->addChild("InitialTBStatus", $infondr['InitialTBStatus']);
	}else{
		$HIVQuestions->addChild("InitialTBStatus", $infondr['InitialTBStatus']);
	}
	
	
	
	/////// add Encounters ///////
	if($infondr['VisitID']==''){
	//$Encounters = $Condition->addChild("Encounters");
	//$HIVEncounter = $Encounters->addChild("HIVEncounter");
	//$HIVEncounter->addChild("VisitID", $infondr['VisitID']);
	//$HIVEncounter->addChild("VisitDate", $infondr['VisitDate']);
	//$HIVEncounter->addChild("DurationOnArt", $infondr['DurationOnArt']);
	//$HIVEncounter->addChild("Weight", $infondr['Weight']);
	//$HIVEncounter->addChild("BloodPressure", $infondr['BloodPressure']);
	//$HIVEncounter->addChild("PatientFamilyPlanningCode", "FP");
	//$HIVEncounter->addChild("PatientFamilyPlanningMethodCode", $infondr['PatientFamilyPlanningMethodCode']);
	//$HIVEncounter->addChild("FunctionalStatus", $infondr['FunctionalStatus']);
	//$HIVEncounter->addChild("WHOClinicalStage", $infondr['WHOClinicalStage']);
	//$HIVEncounter->addChild("TBStatus", $infondr['TBStatus']);
	//$ARVDrugRegimen = $HIVEncounter->addChild("ARVDrugRegimen");
	//$ARVDrugRegimen->addChild("Code", $infondr['Code']);
	//$ARVDrugRegimen->addChild("CodeDescTxt", $infondr['CodeDescTxt']);
	//$CotrimoxazoleDose = $HIVEncounter->addChild("CotrimoxazoleDose");
	//$CotrimoxazoleDose->addChild("Code", $infondr['CodeCTX']);
	//$CotrimoxazoleDose->addChild("CodeDescTxt", $infondr['CodeDescTxtCTX']);
	//$INHDose = $HIVEncounter->addChild("INHDose");
	//$INHDose->addChild("Code", "");
	//$INHDose->addChild("CodeDescTxt", "");
	//$HIVEncounter->addChild("CD4", $infondr['cd4value']);
	//$HIVEncounter->addChild("CD4TestDate", $infondr['CD4TestDate']);
	//$HIVEncounter->addChild("NextAppointmentDate", $infondr['NextAppointmentDate']);
	}else{
	$Encounters = $Condition->addChild("Encounters");
	$HIVEncounter = $Encounters->addChild("HIVEncounter");
	$HIVEncounter->addChild("VisitID", $infondr['VisitID']);		
	$HIVEncounter->addChild("VisitDate", $infondr['VisitDate']);
	if($infondr['DurationOnArt']=='0'||$infondr['DurationOnArt']==''){
	//$HIVEncounter->addChild("DurationOnArt", $infondr['DurationOnArt']);
	}
	else{
	$HIVEncounter->addChild("DurationOnArt", $infondr['DurationOnArt']);
	}
	if($infondr['Weight']==''){
		//$HIVEncounter->addChild("Weight", $infondr['Weight']);
	}else{
		$HIVEncounter->addChild("Weight", $infondr['Weight']);
	}
	if($infondr['BloodPressure']==''){
		//$HIVEncounter->addChild("BloodPressure", $infondr['BloodPressure']);
	}else{
		$HIVEncounter->addChild("BloodPressure", $infondr['BloodPressure']);
	}
	if($infondr['VisitDate']=='0000-00-00'){
		//$HIVEncounter->addChild("PatientFamilyPlanningCode", "FP");
		//$HIVEncounter->addChild("PatientFamilyPlanningMethodCode", $infondr['PatientFamilyPlanningMethodCode']);
	}else{
		$HIVEncounter->addChild("PatientFamilyPlanningCode", "FP");
		$HIVEncounter->addChild("PatientFamilyPlanningMethodCode", $infondr['PatientFamilyPlanningMethodCode']);
	}
	
	
	if($infondr['FunctionalStatus']==''){
		//$HIVEncounter->addChild("FunctionalStatus", $infondr['FunctionalStatus']);
	}else{
		$HIVEncounter->addChild("FunctionalStatus", $infondr['FunctionalStatus']);
	}
	if($infondr['WHOClinicalStage']==''){
		//$HIVEncounter->addChild("WHOClinicalStage", $infondr['WHOClinicalStage']);
	}else{
		$HIVEncounter->addChild("WHOClinicalStage", $infondr['WHOClinicalStage']);
	}
	if($infondr['TBStatus']==''){
		//$HIVEncounter->addChild("TBStatus", $infondr['TBStatus']);
	}else{
		$HIVEncounter->addChild("TBStatus", $infondr['TBStatus']);
	}
	
	if($infondr['VisitDate']=='0000-00-00'){
	//$ARVDrugRegimen = $HIVEncounter->addChild("ARVDrugRegimen");
	//$ARVDrugRegimen->addChild("Code", $infondr['Code']);
	//$ARVDrugRegimen->addChild("CodeDescTxt", $infondr['CodeDescTxt']);
	//$CotrimoxazoleDose = $HIVEncounter->addChild("CotrimoxazoleDose");
	//$CotrimoxazoleDose->addChild("Code", $infondr['CodeCTX']);
	//$CotrimoxazoleDose->addChild("CodeDescTxt", $infondr['CodeDescTxtCTX']);
	}else{
	$ARVDrugRegimen = $HIVEncounter->addChild("ARVDrugRegimen");
	$ARVDrugRegimen->addChild("Code", $infondr['Code']);
	$ARVDrugRegimen->addChild("CodeDescTxt", $infondr['CodeDescTxt']);	
	$CotrimoxazoleDose = $HIVEncounter->addChild("CotrimoxazoleDose");
	$CotrimoxazoleDose->addChild("Code", $infondr['CodeCTX']);
	$CotrimoxazoleDose->addChild("CodeDescTxt", $infondr['CodeDescTxtCTX']);
	}

	
	//$INHDose = $HIVEncounter->addChild("INHDose");
	//$INHDose->addChild("Code", "");
	//$INHDose->addChild("CodeDescTxt", "");
	if($infondr['cd4value']==''){
		//$HIVEncounter->addChild("CD4", $infondr['cd4value']);
		//$HIVEncounter->addChild("CD4TestDate", $infondr['VisitDate']);
	}else{
		$HIVEncounter->addChild("CD4", $infondr['cd4value']);
		$HIVEncounter->addChild("CD4TestDate", $infondr['VisitDate']);
	}
	
	
	if($infondr['NextAppointmentDate']=='0000-00-00'||$infondr['NextAppointmentDate']==''){
		//$HIVEncounter->addChild("NextAppointmentDate", $infondr['NextAppointmentDate']);
	}
	else{
		$HIVEncounter->addChild("NextAppointmentDate", $infondr['NextAppointmentDate']);
	}
	}
	
	
	/////// add LaboratoryReport ///////
	if($infondr['VisitID']==''){
	//$LaboratoryReport = $Condition->addChild("LaboratoryReport");
	//$LaboratoryReport->addChild("VisitID", $infondr['VisitID']);
	}else{
	$LaboratoryReport = $Condition->addChild("LaboratoryReport");
	$LaboratoryReport->addChild("VisitID", $infondr['VisitID']);
		
	}
	if($infondr['VisitDate']==''){
		//$LaboratoryReport->addChild("VisitDate", $infondr['VisitDate']);
	}else{
		$LaboratoryReport->addChild("VisitDate", $infondr['VisitDate']);
	}
	
	if($infondr['LaboratoryTestIdentifier']==''){
		//$LaboratoryReport->addChild("LaboratoryTestIdentifier", $infondr['LaboratoryTestIdentifier']);
	}
	else{
		$LaboratoryReport->addChild("LaboratoryTestIdentifier", $infondr['LaboratoryTestIdentifier']);
	}
	if($infondr['CollectionDate']=='0000-00-00'||$infondr['CollectionDate']==''){
		//$LaboratoryReport->addChild("CollectionDate", $infondr['CollectionDate']);
	}else{
		$LaboratoryReport->addChild("CollectionDate", $infondr['CollectionDate']);
	}
	if($infondr['BaselineRepeatCode']==''){
		//$LaboratoryReport->addChild("BaselineRepeatCode", $infondr['BaselineRepeatCode']);
	}else{
		$LaboratoryReport->addChild("BaselineRepeatCode", $infondr['BaselineRepeatCode']);
	}
	if($infondr['ARTStatusCode']==''){
		//$LaboratoryReport->addChild("ARTStatusCode", $infondr['ARTStatusCode']);
	}else{
		$LaboratoryReport->addChild("ARTStatusCode", $infondr['ARTStatusCode']);
	}
	
	
	if($infondr['VisitDate']==''){
		//$LaboratoryOrderAndResult->addChild("OrderedTestDate", $infondr['VisitDate']);
		//$LaboratoryOrderAndResult = $LaboratoryReport->addChild("LaboratoryOrderAndResult");
		//$LaboratoryResultedTest = $LaboratoryOrderAndResult->addChild("LaboratoryResultedTest");
		//$LaboratoryResultedTest->addChild("Code", "11");
		//$LaboratoryResultedTest->addChild("CodeDescTxt", "CD4");
		//$LaboratoryResult = $LaboratoryOrderAndResult->addChild("LaboratoryResult");
		//$AnswerNumeric = $LaboratoryResult->addChild("AnswerNumeric");
	}else{
		$LaboratoryOrderAndResult = $LaboratoryReport->addChild("LaboratoryOrderAndResult");
		$LaboratoryOrderAndResult->addChild("OrderedTestDate", $infondr['VisitDate']);
		$LaboratoryResultedTest = $LaboratoryOrderAndResult->addChild("LaboratoryResultedTest");
		$LaboratoryResultedTest->addChild("Code", "11");
		$LaboratoryResultedTest->addChild("CodeDescTxt", "CD4");
		$LaboratoryResult = $LaboratoryOrderAndResult->addChild("LaboratoryResult");
		$AnswerNumeric = $LaboratoryResult->addChild("AnswerNumeric");
	}
	
	
	
	
	
	
	if($infondr['Value1']==''){
		//$AnswerNumeric->addChild("Value1", $infondr['Value1']);
	}else{
		$AnswerNumeric->addChild("Value1", $infondr['Value1']);
	}
	if($infondr['VisitDate']==''){
		//$LaboratoryOrderAndResult->addChild("ResultedTestDate", $infondr['VisitDate']);
		//$LaboratoryReport->addChild("Clinician", $infondr['Clinician']);
		//$LaboratoryReport->addChild("ReportedBy", $infondr['ReportedBy']);
		//$LaboratoryReport->addChild("CheckedBy", $infondr['checkedby']);		
	}else{
		$LaboratoryOrderAndResult->addChild("ResultedTestDate", $infondr['VisitDate']);
		$LaboratoryReport->addChild("Clinician", $infondr['Clinician']);
		$LaboratoryReport->addChild("ReportedBy", $infondr['ReportedBy']);
		$LaboratoryReport->addChild("CheckedBy", $infondr['checkedby']);	
	}
	
	

	
	/////// add Regimen 1 ///////
	{		include './mandate_/lidh2.php';
		$sqla="SELECT dispensedate as PrescribedRegimenDispensedDate,CASE drugname1 
WHEN 'AZT/3TC/EFV' THEN '10' 
WHEN 'AZT/3TC/NVP' THEN '10' 
WHEN 'TDF/FTC/EFV' THEN '10' 
WHEN 'TDF/FTC/NVP' THEN '10' 
WHEN 'TDF/3TC/EFV' THEN '10' 
WHEN 'TDF/3TC/NVP' THEN '10' 
WHEN 'AZT/3TC/EFV' THEN '10' 
WHEN 'AZT/3TC/NVP' THEN '10' 
WHEN 'ABC/3TC/EFV' THEN '10'
WHEN 'AZT/3TC/ABC' THEN '11'
WHEN 'AZT/3TC/TDF' THEN '11'
WHEN 'ABC/3TC/NVP' THEN '11'
WHEN 'AZT/3TC/ABC' THEN '11'
WHEN 'ABC/3TC/EFV' THEN '11'
WHEN 'ABC/3TC/EFV' THEN '11'
WHEN 'TDF/FTC/LPV/r' THEN '20'
WHEN 'TDF/3TC/LPV/r' THEN '20'
WHEN 'TDF/FTC/ATV/r' THEN '20'
WHEN 'TDF/3TC/ATV/r' THEN '20'
WHEN 'AZT/3TC/LPV/r' THEN '20'
WHEN 'AZT/3TC/ATV/r' THEN '20'
WHEN 'ABC/3TC/LPV/r' THEN '20'
WHEN 'AZT/3TC/LPV/r' THEN '20' 
WHEN 'd4T/3TC/LPV/r' THEN '20' 
WHEN 'ddi/3TC/NVP' THEN '20' 
WHEN 'ABC/3TC/ddi' THEN '20' 
WHEN 'DAR' THEN '30' 
WHEN 'RAL' THEN '30' 
WHEN 'ETR' THEN '30' 
WHEN 'RTV' THEN '30' 
ELSE '' END as PrescribedRegimenLineCode,CASE drugname1 
WHEN 'AZT/3TC/EFV' THEN '1a' 
WHEN 'AZT/3TC/NVP' THEN '1b' 
WHEN 'TDF/FTC/EFV' THEN '1c' 
WHEN 'TDF/FTC/NVP' THEN '1d' 
WHEN 'TDF/3TC/EFV' THEN '1e' 
WHEN 'TDF/3TC/NVP' THEN '1f' 
WHEN 'AZT/3TC/ABC' THEN '1g' 
WHEN 'AZT/3TC/TDF' THEN '1h' 
WHEN 'TDF/FTC/LPV/r' THEN '2a' 
WHEN 'TDF/3TC/LPV/r' THEN '2b' 
WHEN 'TDF/FTC/ATV/r' THEN '2c' 
WHEN 'TDF/3TC/ATV/r' THEN '2d' 
WHEN 'AZT/3TC/LPV/r' THEN '2e' 
WHEN 'AZT/3TC/ATV/r' THEN '2f' 
WHEN 'ABC/3TC/NVP' THEN '4d' 
WHEN 'ABC/3TC/EFV' THEN '4c' 
WHEN 'd4T/3TC/NVP' THEN '4d'
WHEN 'ABC/3TC/LPV/r' THEN '5a'
WHEN 'd4T/3TC/LPV/r' THEN '5c'
WHEN 'ddi/3TC/NVP' THEN '5d'
WHEN 'ABC/3TC/ddi' THEN '5e'
WHEN 'TLC' THEN '4' 
ELSE '' END as CodePharmDrgName1,CASE drugname1 
WHEN 'AZT/3TC/EFV' THEN 'AZT-3TC-EFV' 
WHEN 'AZT/3TC/NVP' THEN 'AZT-3TC-NVP' 
WHEN 'TDF/FTC/EFV' THEN 'TDF-FTC-EFV' 
WHEN 'TDF/FTC/NVP' THEN 'TDF-FTC-NVP' 
WHEN 'TDF/3TC/EFV' THEN 'TDF-3TC-EFV' 
WHEN 'TDF/3TC/NVP' THEN 'TDF-3TC-NVP' 
WHEN 'AZT/3TC/ABC' THEN 'AZT-3TC-ABC' 
WHEN 'AZT/3TC/TDF' THEN 'AZT-3TC-TDF' 
WHEN 'ABC/3TC/NVP' THEN 'ABC-3TC-NVP' 
WHEN 'ABC/3TC/EFV' THEN 'ABC-3TC-EFV' 
WHEN 'd4T/3TC/NVP' THEN 'd4T-3TC-NVP'
WHEN 'ABC/3TC/LPV/r' THEN 'ABC-3TC-LPV/r'
WHEN 'd4T/3TC/LPV/r' THEN 'd4T-3TC-LPV/r'
WHEN 'ddi/3TC/NVP' THEN 'ddi-3TC-NVP'
WHEN 'ABC/3TC/ddi' THEN 'ABC-3TC-ddi'
WHEN 'TDF/FTC/LPV/r' THEN 'TDF-FTC-LPV/r' 
WHEN 'TDF/3TC/LPV/r' THEN 'TDF-3TC-LPV/r' 
WHEN 'TDF/FTC/ATV/r' THEN 'TDF-FTC-ATV/r' 
WHEN 'TDF/3TC/ATV/r' THEN 'TDF-3TC-ATV/r' 
WHEN 'AZT/3TC/LPV/r' THEN 'AZT-3TC-LPV/r' 
WHEN 'AZT/3TC/ATV/r' THEN 'AZT-3TC-ATV/r' 
ELSE '' END as CodeDescTxtPharmDrgName1 ,pharmacyid as VisitIDpharm,visitdate as VisitDatepharm,regduration1 as PrescribedRegimenDuration
FROM pharmacy 
where pepid='$infondr[pepid]' AND drugname1!=''
order by visitdate DESC LIMIT 1";
		$resulta=mysqli_query($con,$sqla);
		$info1a=mysqli_fetch_assoc($resulta);
	if($info1a['CodeDescTxtPharmDrgName1']==''){
	//$Regimen = $Condition->addChild("Regimen");
	//$Regimen->addChild("VisitID", $infondr['VisitIDpharm']);
	//$Regimen->addChild("VisitDate", $infondr['VisitDatepharm']);
	
	//$PrescribedRegimen = $Regimen->addChild("PrescribedRegimen");
	//$PrescribedRegimen->addChild("Code", $infondr['CodePharmDrgName1']);
	//$PrescribedRegimen->addChild("CodeDescTxt", $infondr['CodeDescTxtPharmDrgName1']);
	
	//$Regimen->addChild("PrescribedRegimenTypeCode", "ART");
	//$Regimen->addChild("PrescribedRegimenLineCode", $infondr['PrescribedRegimenLineCode']);
	//$Regimen->addChild("PrescribedRegimenDuration", $infondr['PrescribedRegimenDuration']);
	//$Regimen->addChild("PrescribedRegimenDispensedDate", $infondr['PrescribedRegimenDispensedDate']);
	//$Regimen->addChild("DateRegimenStarted", $info1['DateRegimenStarted']);
	//$Regimen->addChild("DateRegimenStartedDD", $info1['DateRegimenStartedDD']);
	//$Regimen->addChild("DateRegimenStartedMM", $info1['DateRegimenStartedMM']);
	//$Regimen->addChild("DateRegimenStartedYYYY", $info1['DateRegimenStartedYYYY']);
	//$Regimen->addChild("PrescribedRegimenInitialIndicator", "false");
	//$Regimen->addChild("PrescribedRegimenCurrentIndicator", "false");
	//$Regimen->addChild("TypeOfPreviousExposureCode", "N");
	//$Regimen->addChild("SubstitutionIndicator", "false");
	//$Regimen->addChild("SwitchIndicator", "false");
	}
	else{
		include './mandate_/lidh2.php';
		$sql="SELECT visitdate as DateRegimenStarted,DATE_FORMAT(visitdate,'%d') as DateRegimenStartedDD,DATE_FORMAT(visitdate,'%c') as DateRegimenStartedMM,DATE_FORMAT(visitdate,'%Y') as DateRegimenStartedYYYY FROM pharmacy where pepid='$infondr[pepid]' AND drugname1!='' order by visitdate ASC LIMIT 1";
		$result=mysqli_query($con,$sql);
		$info1=mysqli_fetch_assoc($result);
		
	$Regimen = $Condition->addChild("Regimen");
	$Regimen->addChild("VisitID", $info1a['VisitIDpharm']);
	$Regimen->addChild("VisitDate", $info1a['VisitDatepharm']);
	
	$PrescribedRegimen = $Regimen->addChild("PrescribedRegimen");;
	$PrescribedRegimen->addChild("Code", $info1a['CodePharmDrgName1']);
	$PrescribedRegimen->addChild("CodeDescTxt", $info1a['CodeDescTxtPharmDrgName1']);
	
	$Regimen->addChild("PrescribedRegimenTypeCode", "ART");
	$Regimen->addChild("PrescribedRegimenLineCode", $info1a['PrescribedRegimenLineCode']);
	$Regimen->addChild("PrescribedRegimenDuration", $info1a['PrescribedRegimenDuration']);
	$Regimen->addChild("PrescribedRegimenDispensedDate", $info1a['PrescribedRegimenDispensedDate']);
	$Regimen->addChild("DateRegimenStarted", $info1['DateRegimenStarted']);
	$Regimen->addChild("DateRegimenStartedDD", $info1['DateRegimenStartedDD']);
	$Regimen->addChild("DateRegimenStartedMM", $info1['DateRegimenStartedMM']);
	$Regimen->addChild("DateRegimenStartedYYYY", $info1['DateRegimenStartedYYYY']);
	$Regimen->addChild("PrescribedRegimenInitialIndicator", "false");
	$Regimen->addChild("PrescribedRegimenCurrentIndicator", "false");
	$Regimen->addChild("TypeOfPreviousExposureCode", "N");
	$Regimen->addChild("SubstitutionIndicator", "false");
	$Regimen->addChild("SwitchIndicator", "false");
	}}
	/////// add Regimen 2 ///////
	{	include './mandate_/lidh2.php';
		$sqlb="SELECT pharmacyid as VisitIDCTX,visitdate as PrescribedRegimenDispensedDateCTX,CASE  
WHEN oiqty like '%100%' AND oidrug like '%CTX%' THEN 'CTX100' 
WHEN oiqty like '%200%' AND oidrug like '%CTX%' THEN 'CTX200' 
WHEN oiqty like '%300%' AND oidrug like '%CTX%' THEN 'CTX300' 
WHEN oiqty like '%480%' AND oidrug like '%CTX%' THEN 'CTX480' 
WHEN oiqty like '%960%' AND oidrug like '%CTX%' THEN 'CTX960' 
ELSE '' END as CodeCTXPharm,CASE  
WHEN oiqty like '%100%' AND oidrug like '%CTX%' THEN 'Cotrimoxazole 100mg' 
WHEN oiqty like '%200%' AND oidrug like '%CTX%' THEN 'Cotrimoxazole 200mg' 
WHEN oiqty like '%300%' AND oidrug like '%CTX%' THEN 'Cotrimoxazole 300mg' 
WHEN oiqty like '%480%' AND oidrug like '%CTX%' THEN 'Cotrimoxazole 480mg' 
WHEN oiqty like '%960%' AND oidrug like '%CTX%' THEN 'Cotrimoxazole 960mg' 
ELSE '' END as CodeDescTxtCTXPharm,CASE oiduration 
WHEN '1 month' THEN '30' 
WHEN '2 month' THEN '60' 
WHEN '3 month' THEN '90' 
WHEN '4 month' THEN '120' 
ELSE '' END as PrescribedRegimenDurationCTXpharm
FROM pharmacy 
where pepid='$infondr[pepid]' and lower(oidrug) like '%ctx%'
order by visitdate DESC LIMIT 1";
		$resultb=mysqli_query($con,$sqlb);
		$info1b=mysqli_fetch_assoc($resultb);
	if($info1b['CodeDescTxtCTXPharm']==''){

	//$Regimen = $Condition->addChild("Regimen");
	//$Regimen->addChild("VisitID", $infondr['VisitIDpharm']);
	//$Regimen->addChild("VisitDate", $infondr['VisitDatepharm']);
	
	//$PrescribedRegimen = $Regimen->addChild("PrescribedRegimen");
	//$PrescribedRegimen->addChild("Code", $infondr['CodeCTX']);
	//$PrescribedRegimen->addChild("CodeDescTxt", $infondr['CodeDescTxtCTX']);
	
	//$Regimen->addChild("PrescribedRegimenTypeCode", $infondr['PrescribedRegimenDurationCTXpharm']);
	//$Regimen->addChild("PrescribedRegimenDuration", $info1['DateRegimenStarted']);
	//$Regimen->addChild("PrescribedRegimenDispensedDate", $info1['DateRegimenStarted']);
	//$Regimen->addChild("DateRegimenStarted", $info1['DateRegimenStarted']);
	//$Regimen->addChild("DateRegimenStartedDD", $info1['DateRegimenStartedDD']);
	//$Regimen->addChild("DateRegimenStartedMM", $info1['DateRegimenStartedMM']);
	//$Regimen->addChild("DateRegimenStartedYYYY", $info1['DateRegimenStartedYYYY']);
	//$Regimen->addChild("PrescribedRegimenInitialIndicator", "true");
	//$Regimen->addChild("PrescribedRegimenCurrentIndicator", "true");
	//$Regimen->addChild("SubstitutionIndicator", "false");
	//$Regimen->addChild("SwitchIndicator", "false");
	}
	else{
		include './mandate_/lidh2.php';
		$sql="SELECT dispensedate as DateRegimenStarted,DATE_FORMAT(dispensedate,'%d') as DateRegimenStartedDD,DATE_FORMAT(dispensedate,'%c') as DateRegimenStartedMM,DATE_FORMAT(dispensedate,'%Y') as DateRegimenStartedYYYY FROM pharmacy where pepid='$infondr[pepid]' and lower(oidrug) like '%ctx%' order by visitdate ASC LIMIT 1";
		$result=mysqli_query($con,$sql);
		$info1=mysqli_fetch_assoc($result);
		
	$Regimen = $Condition->addChild("Regimen");
	$Regimen->addChild("VisitID", $info1b['VisitIDCTX']);
	$Regimen->addChild("VisitDate", $info1b['PrescribedRegimenDispensedDateCTX']);
	
	$PrescribedRegimen = $Regimen->addChild("PrescribedRegimen");
	$PrescribedRegimen->addChild("Code", $info1b['CodeCTXPharm']);
	$PrescribedRegimen->addChild("CodeDescTxt", $info1b['CodeDescTxtCTXPharm']);
	
	$Regimen->addChild("PrescribedRegimenTypeCode", "CTX");
	$Regimen->addChild("PrescribedRegimenDuration", $info1b['PrescribedRegimenDurationCTXpharm']);
	$Regimen->addChild("PrescribedRegimenDispensedDate", $info1b['PrescribedRegimenDispensedDateCTX']);
	$Regimen->addChild("DateRegimenStarted", $info1['DateRegimenStarted']);
	$Regimen->addChild("DateRegimenStartedDD", $info1['DateRegimenStartedDD']);
	$Regimen->addChild("DateRegimenStartedMM", $info1['DateRegimenStartedMM']);
	$Regimen->addChild("DateRegimenStartedYYYY", $info1['DateRegimenStartedYYYY']);
	$Regimen->addChild("PrescribedRegimenInitialIndicator", "true");
	$Regimen->addChild("PrescribedRegimenCurrentIndicator", "true");
	$Regimen->addChild("SubstitutionIndicator", "false");
	$Regimen->addChild("SwitchIndicator", "false");
		}
	}
	/////// add Regimen 3 ///////
	{include './mandate_/lidh2.php';
		$sqlc="SELECT pharmacyid as VisitIDtb,visitdate as visitdateTB,CASE tbduration 
WHEN '1 month' THEN '30' 
WHEN '2 month' THEN '60' 
WHEN '3 month' THEN '90' 
WHEN '4 month' THEN '120' 
ELSE '' END as PrescribedRegimenDurationTBpharm,CASE  
WHEN tbdrug LIKE '%INH%' and tbdrug LIKE '%Rifampicin%' AND tbdrug LIKE '%PZI%' AND tbdrug LIKE '%Streptomycin Injection%' AND tbdrug LIKE '%Ethambutol%' THEN 'HRZES'
WHEN tbdrug LIKE '%INH%' and tbdrug LIKE '%Rifampicin%' AND tbdrug LIKE '%PZI%' AND tbdrug LIKE '%Ethambutol%' THEN 'HRZE' 
WHEN tbdrug LIKE '%INH%' and tbdrug LIKE '%Rifampicin%' AND tbdrug LIKE '%Ethambutol%' THEN 'HRE' 
WHEN tbdrug LIKE '%INH%' and tbdrug LIKE '%Rifampicin%' AND tbdrug LIKE '%Streptomycin Injection%' THEN 'HRS' 
WHEN tbdrug LIKE '%INH%' and tbdrug LIKE '%Rifampicin%' THEN 'HR' 
WHEN tbdrug LIKE '%INH%' AND tbdrug LIKE '%Ethambutol%' THEN 'HE' 
WHEN tbdrug LIKE '%Streptomycin Injection%' THEN 'S' 
WHEN tbdrug LIKE '%PZI%' THEN 'Z' 
WHEN tbdrug LIKE '%Ethambutol%' THEN 'E' 
WHEN tbdrug LIKE '%Rifampicin%' THEN 'R' 
WHEN tbdrug LIKE '%INH%' THEN 'H'  
ELSE '' END as tbdrugcode,tbdrug as tbdrug
FROM pharmacy 
where pepid='$infondr[pepid]' and (lower(tbdrug) like '%rifampicin%' or lower(tbdrug) like '%inh%' or lower(tbdrug) like '%strept%' or lower(tbdrug) like '%etham%' or lower(tbdrug) like '%pzi%')
order by visitdate DESC LIMIT 1";
		$resultc=mysqli_query($con,$sqlc);
		$info2c=mysqli_fetch_assoc($resultc);

	if($info2c['tbdrugcode']==''){
	//$Regimen = $Condition->addChild("Regimen");
	//$Regimen->addChild("VisitID", $infondr['VisitIDpharm']);
	//$Regimen->addChild("VisitDate", $infondr['VisitDatepharm']);
	
	//$PrescribedRegimen = $Regimen->addChild("PrescribedRegimen");
	//$PrescribedRegimen->addChild("Code", $infondr['tbdrugcode']);
	//$PrescribedRegimen->addChild("CodeDescTxt", $infondr['tbdrug']);
	
	//$Regimen->addChild("PrescribedRegimenTypeCode", "TB");
	//$Regimen->addChild("PrescribedRegimenDuration", $info2['PrescribedRegimenDurationTBpharm']);
	//$Regimen->addChild("PrescribedRegimenDispensedDate", $info2['DateRegimenStarted']);
	//$Regimen->addChild("DateRegimenStarted", $info2['DateRegimenStarted']);
	//$Regimen->addChild("DateRegimenStartedDD", $info2['DateRegimenStartedDD']);
	//$Regimen->addChild("DateRegimenStartedMM", $info2['DateRegimenStartedMM']);
	//$Regimen->addChild("DateRegimenStartedYYYY", $info2['DateRegimenStartedYYYY']);
	//$Regimen->addChild("PrescribedRegimenInitialIndicator", "true");
	//$Regimen->addChild("PrescribedRegimenCurrentIndicator", "true");
	//$Regimen->addChild("SubstitutionIndicator", "false");
	//$Regimen->addChild("SwitchIndicator", "false");
	}
	else{
		include './mandate_/lidh2.php';
		$sql="SELECT dispensedate as DateRegimenStarted,DATE_FORMAT(dispensedate,'%d') as DateRegimenStartedDD,DATE_FORMAT(dispensedate,'%c') as DateRegimenStartedMM,DATE_FORMAT(dispensedate,'%Y') as DateRegimenStartedYYYY FROM pharmacy where pepid='$infondr[pepid]' and (lower(tbdrug) like '%rifampicin%' or lower(tbdrug) like '%inh%' or lower(tbdrug) like '%strept%' or lower(tbdrug) like '%etham%' or lower(tbdrug) like '%pzi%') order by visitdate ASC LIMIT 1";
		$result=mysqli_query($con,$sql);
		$info2=mysqli_fetch_assoc($result);
	$Regimen = $Condition->addChild("Regimen");
	$Regimen->addChild("VisitID", $info2c['VisitIDtb']);
	$Regimen->addChild("VisitDate", $info2c['visitdateTB']);
	
	$PrescribedRegimen = $Regimen->addChild("PrescribedRegimen");
	$PrescribedRegimen->addChild("Code", $info2c['tbdrugcode']);
	$PrescribedRegimen->addChild("CodeDescTxt", $info2c['tbdrug']);
	
	$Regimen->addChild("PrescribedRegimenTypeCode", "TB");
	$Regimen->addChild("PrescribedRegimenDuration", $info2c['PrescribedRegimenDurationTBpharm']);
	$Regimen->addChild("PrescribedRegimenDispensedDate", $info2c['visitdateTB']);
	$Regimen->addChild("DateRegimenStarted", $info2['DateRegimenStarted']);
	$Regimen->addChild("DateRegimenStartedDD", $info2['DateRegimenStartedDD']);
	$Regimen->addChild("DateRegimenStartedMM", $info2['DateRegimenStartedMM']);
	$Regimen->addChild("DateRegimenStartedYYYY", $info2['DateRegimenStartedYYYY']);
	$Regimen->addChild("PrescribedRegimenInitialIndicator", "true");
	$Regimen->addChild("PrescribedRegimenCurrentIndicator", "true");
	$Regimen->addChild("SubstitutionIndicator", "false");
	$Regimen->addChild("SwitchIndicator", "false");
	}
	}
	/////////////////////////////////////////////////////////////End Condition//////////////////////////////////// 
$filen=""; 
$filen.="INITIAL_"; 
$filen.=date('YmdHis')."_";
$filen.=$infondr['PatientIdentifier'];

////////////////////CREATE ndr FOLDER/////////////
if (!file_exists('c:\ndr')) {
    mkdir('c:\ndr', 0777, true);
}
    /*** echo the xml ***/ 
    $Container->asXML("c:\\ndr\\".$filen.".xml"); 
	echo $filen.' Generated...'.'<br>';
 
    }
catch( Exception $e ) 
{ 
    echo $e->getMessage(); 
} 
?>
   </body>
   </html>