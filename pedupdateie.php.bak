<?php
session_start();
$_SESSION=$_POST;
if(isset($_POST['symptomsreview'])) {
$symptomsreview = implode(", ", $_POST['symptomsreview']);
} else {
$symptomsreview = "";
}
if(isset($_POST['riskfactors'])) {
$riskfactors = implode(", ", $_POST['riskfactors']);
} else {
$riskfactors = "";
}
if(isset($_POST['currentmedications'])) {
$currentmedications = implode(", ", $_POST['currentmedications']);
} else {
$currentmedications = "";
}
if(isset($_POST['hivstatdisclosure'])) {
$hivstatdisclosure = implode(", ", $_POST['hivstatdisclosure']);
} else {
$hivstatdisclosure = "";
}
if(isset($_POST['pastcurrarvsideeff'])) {
$pastcurrarvsideeff = implode(", ", $_POST['pastcurrarvsideeff']);
} else {
$pastcurrarvsideeff = "";
}
if(isset($_POST['pegenappearance'])) {
$pegenappearance = implode(", ", $_POST['pegenappearance']);
} else {
$pegenappearance = "";
}
if(isset($_POST['peskin'])) {
$peskin = implode(", ", $_POST['peskin']);
} else {
$peskin = "";
}
if(isset($_POST['peheadeye'])) {
$peheadeye = implode(", ", $_POST['peheadeye']);
} else {
$peheadeye = "";
}
if(isset($_POST['pebreasts'])) {
$pebreasts = implode(", ", $_POST['pebreasts']);
} else {
$pebreasts = "";
}
if(isset($_POST['pecardiovascular'])) {
$pecardiovascular = implode(", ", $_POST['pecardiovascular']);
} else {
$pecardiovascular = "";
}
if(isset($_POST['pegenitalia'])) {
$pegenitalia = implode(", ", $_POST['pegenitalia']);
} else {
$pegenitalia = "";
}
if(isset($_POST['gerespiratory'])) {
$gerespiratory = implode(", ", $_POST['gerespiratory']);
} else {
$gerespiratory = "";
}
if(isset($_POST['gegastrointestinal'])) {
$gegastrointestinal = implode(", ", $_POST['gegastrointestinal']);
} else {
$gegastrointestinal = "";
}
if(isset($_POST['geneurological'])) {
$geneurological = implode(", ", $_POST['geneurological']);
} else {
$geneurological = "";
}
if(isset($_POST['gementalstatus'])) {
$gementalstatus = implode(", ", $_POST['gementalstatus']);
} else {
$gementalstatus = "";
}
if(isset($_POST['plan'])) {
$plan = implode(", ", $_POST['plan']);
} else {
$plan = "";
}
if(isset($_POST['prevarvexp'])) {
$prevarvexp=$_POST['prevarvexp'];
}else {
$prevarvexp = "";
}
if(isset($_POST['serviceentry'])) {
$serviceentry=$_POST['serviceentry'];
}else {
$serviceentry = "";
}
if(isset($_POST['adherenceyn'])) {
$adherenceyn=$_POST['adherenceyn'];
}else {
$adherenceyn = "";
}
if(isset($_POST['missedadh3daysyn'])) {
$missedadh3daysyn=$_POST['missedadh3daysyn'];
}else {
$missedadh3daysyn = "";
}
if(isset($_POST['trtmtinterruptionyn'])) {
$trtmtinterruptionyn=$_POST['trtmtinterruptionyn'];
}else {
$trtmtinterruptionyn="";
}
if(isset($_POST['trtmtstopyn'])) {
$trtmtstopyn=$_POST['trtmtstopyn'];
}else {
$trtmtstopyn="";
}
if(isset($_POST['supportgrpyn'])) {
$supportgrpyn=$_POST['supportgrpyn'];
}else {
$supportgrpyn="";
}
if(isset($_POST['assessment'])) {
$assessment=$_POST['assessment'];
}else {
$assessment="";
}
if(isset($_POST['whostagecriteria'])) {
$whostagecriteria = implode(", ", $_POST['whostagecriteria']);
} else {
$whostagecriteria = "";
}

if(isset($_POST['enrollin'])) {
$enrollin=$_POST['enrollin'];
}else {
$enrollin="";
}
if(isset($_POST['regimen1st'])) {
$regimen1st=$_POST['regimen1st'];
}else {
$regimen1st="";
}
if(isset($_POST['planarvtherapy'])) {
$planarvtherapy=$_POST['planarvtherapy'];
}else {
$planarvtherapy="";
}
if(isset($_POST['regimen1st'])) {
$regimen1st=$_POST['regimen1st'];
}else {
$regimen1st="";
}
if(isset($_POST['nextappointment'])) {
$nextappointment=$_POST['nextappointment'];
}else {
$nextappointment="";
}
if(isset($_POST['pcurrmeds'])) {
$pcurrmeds=$_POST['pcurrmeds'];
}else {
$pcurrmeds="";
}
if(isset($_POST['hospitalid'])) {
$hospitalid=$_POST['hospitalid'];
}else {
$hospitalid="";
}
?>

<?php
$con=mysqli_connect("localhost","root","Nu66et%%","apindb");
// Check connection
if (mysqli_connect_errno())
  {
  echo "Failed to connect to MySQL: " . mysqli_connect_error();
  }
$pepid = $_POST['pepid'];  
$sql="UPDATE patient 
   SET 
   hospitalid='$_POST[hospitalid]',
   presentingcomplaint='$_POST[presentingcomplaint]',
   symptomsreview='$symptomsreview',
   dur_fever='$_POST[dur_fever]',
   dur_nausea='$_POST[dur_nausea]',
   dur_nsweats='$_POST[dur_nsweats]',
   dur_weigthl='$_POST[dur_weigthl]',
   dur_cough='$_POST[dur_cough]',
   dur_head='$_POST[dur_head]',
   dur_rash='$_POST[dur_rash]',
   dur_itch='$_POST[dur_itch]',
   dur_diarh='$_POST[dur_diarh]',
   dur_gendis='$_POST[dur_gendis]',
   dur_genitch='$_POST[dur_genitch]',
   dur_gensore='$_POST[dur_gensore]',
   dur_eardis='$_POST[dur_eardis]',
   dur_painmict='$_POST[dur_painmict]',
   dur_oralsores='$_POST[dur_oralsores]',
   dur_irr='$_POST[dur_irr]',
   dur_sleep='$_POST[dur_sleep]',
   dur_food='$_POST[dur_food]',
   dur_convul='$_POST[dur_convul]',
   jobstatusmother='$_POST[jobstatusmother]',
   jobstatusfather='$_POST[jobstatusfather]',
   educationallevelcaregiver='$_POST[educationallevelcaregiver]',
   jobstatuscaregiver='$_POST[jobstatuscaregiver]',
   educationallevelmother='$_POST[educationallevelmother]',
   educationallevelchild='$_POST[educationallevelchild]',
   educationallevelfather='$_POST[educationallevelfather]',
   pchildliveswith='$_POST[pchildliveswith]',
   planpalliative='$_POST[planpalliative]',
   planref='$_POST[planref]',
   plancounsel='$_POST[plancounsel]',
   plancxr='$_POST[planpmtct]',
   dur_shortbreath='$_POST[dur_shortbreath]',
   dur_visimp='$_POST[dur_visimp]',
   dur_painswall='$_POST[dur_painswall]',
   dur_numb='$_POST[dur_numb]',
   dur_otherpain='$_POST[dur_otherpain]',
   addiotnalsymcmments='$_POST[addiotnalsymcmments]',
   pastmedicalhist='$_POST[pastmedicalhist]',
   relfamilyhist='$_POST[relfamilyhist]',
   hospitalization='$_POST[hospitalization]',
   drugallergies='$_POST[drugallergies]',
   riskfactors='$riskfactors',
   lastcd4='$_POST[lastcd4]',
   lastcd4date='$_POST[lastcd4date]',
   lastvl='$_POST[lastvl]',
   lastvldate='$_POST[lastvldate]',
   prevarvexp='$prevarvexp',
   prevfacilityname='$_POST[prevfacilityname]',
   prevdurationofcarefromdate='$_POST[prevdurationofcarefromdate]',
   prevdurationofcaretodate='$_POST[prevdurationofcaretodate]',
   prevarvtype='$_POST[prevarvtype]',
   currentmedications='$currentmedications',
   serviceentry='$serviceentry',
   adherenceyn='$adherenceyn',
   missedadh3daysyn='$missedadh3daysyn',
   missadhreason='$_POST[missadhreason]',
   missedadhcode='$_POST[missedadhcode]',
   interradhcode='$_POST[interradhcode]',
   stopadhcode='$_POST[stopadhcode]',
   trtmtinterruptionyn='$trtmtinterruptionyn',
   trtmtinterdate='$_POST[trtmtinterdate]',
   trtmtinterduration='$_POST[trtmtinterduration]',
   trtmtinterreason='$_POST[trtmtinterreason]',
   trtmtstopyn='$trtmtstopyn',
   trtmtstopdate='$_POST[trtmtstopdate]',
   trtmtstopduration='$_POST[trtmtstopduration]',
   trtmtstopreason='$_POST[trtmtstopreason]',
   hivstatdisclosure='$hivstatdisclosure',
   hivstatdisclosureother='$_POST[hivstatdisclosureother]',
   hivstatdiscussion='$_POST[hivstatdiscussion]',
   supportgrpyn='$supportgrpyn',
   pastcurrarvsideeff='$pastcurrarvsideeff',
   petemp='$_POST[petemp]',
   pebp='$_POST[pebp]',
   pepulse='$_POST[pepulse]',
   peweight='$_POST[peweight]',
   peheight='$_POST[peheight]',
   pedsurface='$_POST[pedsurface]',
   pedcircumf='$_POST[pedcircumf]',
   pedmuac='$_POST[pedmuac]',
   pegenappearance='$pegenappearance',
   peskin='$peskin',
   peheadeye='$peheadeye',
   pebreasts='$pebreasts',
   pecardiovascular='$pecardiovascular',
   pegenitalia='$pegenitalia',
   gerespiratory='$gerespiratory',
   gerespiratoryrate='$_POST[gerespiratoryrate]',
   gegastrointestinal='$gegastrointestinal',
   geneurological='$geneurological',
   gementalstatus='$gementalstatus',
   peadditional='$_POST[pedadditional]',
   pdevassess='$_POST[pdevassess]',
   ppreviousarvexp='$_POST[ppreviousarvexp]',
   pprevarvtrtmt='$_POST[pprevarvtrtmt]',
   ppreviousarvpmtct='$_POST[ppreviousarvpmtct]',
   pprevarvdrugs='$_POST[pprevarvdrugs]',
   pedadditional='$_POST[pedadditional]',
   assessmentnotes='$_POST[assessmentnotes]',
   assessment='$assessment',
   whostagecriteria='$whostagecriteria',
   whostage='$_POST[whostage]',
   planlab='$_POST[planlab]',
   plantbs='$_POST[plantbs]',
   planoip='$_POST[planoip]',
   planpep='$_POST[planpep]',
   planadh='$_POST[planadh]',
   planoit='$_POST[planoit]',
   planadm='$_POST[planadm]',
   planpain='$_POST[planpain]',
   pimmunecomplete='$_POST[pimmunecomplete]',
   pfeedingmode='$_POST[pfeedingmode]',
   plan='$plan',
   planother='$_POST[planother]',
   enrollin='$enrollin',
   regimen1st='$regimen1st',
   planarvtherapy='$planarvtherapy',
   planarvtherchgtrtmtreason='$_POST[planarvtherchgtrtmtreason]',
   planarvtherstoptrtmtreason='$_POST[planarvtherstoptrtmtreason]',
   regimen1st='$regimen1st',
   regimen2nd='$_POST[regimen2nd]',
   regimenothers='$_POST[regimenothers]',
   nextappointment='$nextappointment',
   nextappointmentdate='$_POST[nextappointmentdate]',
   enroldate='$_POST[visitdate]',
   pcurrmeds='$pcurrmeds',
   Clinicianname='$_POST[Clinicianname]'
   WHERE pepid='$pepid'";
   
if (!mysqli_query($con,$sql))
  {
  die('Error: ' . mysqli_error($con));
  }
  {
	include './mandate_/lidhX.php';
$sql="INSERT into AUDIT_TRAIL (server_name,user_name,action) VALUES('$_SERVER[REMOTE_ADDR]','$_SESSION[login_id]','UPDATE - I.E.: $_POST[pepid]')";
$result=mysqli_query($con,$sql);
}
echo "Update successful... Redirecting, Please wait...";
header('Location: ./patpedsummary.php?pepid='.$pepid.'&login_id='.$_POST['login_id']);

mysqli_close($con);
/*var_dump($_POST)*/
?>
<?php 
	class MyClassndr{ 
    public function GetUserInformation(){ 
$query = "SELECT a.PEPID as PatientIdentifier,(select facilityname from facility) as FacilityName,uniqueid as IDNumber,dob as PatientDateOfBirth,substring(upper(sex),1,1) as PatientSexCode,CASE lower(patientdied) WHEN 'art' THEN 'true' WHEN 'pre-art' THEN 'true' ELSE 'false' END as PatientDeceasedIndicator,CASE educationallevel WHEN 'None' THEN 1 WHEN 'Quranic' THEN 4 WHEN 'Primary' THEN 2 WHEN 'Junior Secondary' THEN 5 WHEN 'Senior Secondary' THEN 3 WHEN 'Post Secondary' THEN 6 ELSE 7 END as PatientEducationLevelCode,CASE jobstatus WHEN 'Unemployed' THEN 'UNE' WHEN 'Student' THEN 'STU' WHEN 'Employed' THEN 'EMP' WHEN 'Retired' THEN 'RET' ELSE 'UNK' END as PatientOccupationCode,CASE maritalstatus WHEN 'Single' THEN 'S' WHEN 'Widowed' THEN 'W' WHEN 'Married' THEN 'M' WHEN 'Separated' THEN 'A' WHEN 'Divorced' THEN 'D' ELSE 'U' END as PatientMaritalStatusCode,CASE  
WHEN whostagecriteria LIKE '%Asymptomatic%' THEN '236704009' 
WHEN whostagecriteria LIKE '%Persistent Lymphadenopathy%' THEN '95892003' 
WHEN whostagecriteria LIKE '%Minor Mucocutaneous Manifestations%' THEN '29147005' 
WHEN whostagecriteria LIKE '%Herpes Zoster%' THEN '4740000' 
WHEN whostagecriteria LIKE '%Recurrent Upper Respiratory Tract Infections%' THEN '195708003' 
WHEN whostagecriteria LIKE '%Unexplained Chronic Diarrhea%' THEN '86615009' 
WHEN whostagecriteria LIKE '%Unexplained Prolonged Fever%' THEN '409553007' 
WHEN whostagecriteria LIKE '%Oral Candidiasis%' THEN '79740000' 
WHEN whostagecriteria LIKE '%Oral Hairy Leukoplakia%' THEN '235032001' 
WHEN whostagecriteria LIKE '%TB, Pulmonary%' THEN '154283005' 
WHEN whostagecriteria LIKE '%Severe Bacterial Infections%' THEN '428875002' 
WHEN whostagecriteria LIKE '%PCP%' THEN '75549005' 
WHEN whostagecriteria LIKE '%Toxoplasmosis, CNS%' THEN '187192000' 
WHEN whostagecriteria LIKE '%Cryptosporidiosis with Diarrhea%' THEN '240370009' 
WHEN whostagecriteria LIKE '%Cryptococcosis, Extrapulmonary%' THEN '20953001' 
WHEN whostagecriteria LIKE '%Cytomegalovirus disease%' THEN '28944009' 
WHEN whostagecriteria LIKE '%Herpes Simplex%' THEN '88594005' 
WHEN whostagecriteria LIKE '%Progressive Multifocal Leukoencephalopathy%' THEN '22255007' 
WHEN whostagecriteria LIKE '%Mycosis, disseminated%' THEN '402138008' 
WHEN whostagecriteria LIKE '%Candidiasis%' THEN '78048006' 
WHEN whostagecriteria LIKE '%Atypical Mycobacteriosis, disseminated%' THEN '88415009' 
WHEN whostagecriteria LIKE '%Oral Candidiasis%' THEN '79740000' 
ELSE '' 
END as ConditionCode,WardVillage, town,CASE  
WHEN lower(state) LIKE '%abia%' THEN '1' 
WHEN lower(state) LIKE '%adamawa%' THEN '2' 
WHEN lower(state) LIKE '%akwaibom%' THEN '3' 
WHEN lower(state) LIKE '%anambra%' THEN '4' 
WHEN lower(state) LIKE '%bauchi%' THEN '5' 
WHEN lower(state) LIKE '%benue%' THEN '6' 
WHEN lower(state) LIKE '%bayelsa%' THEN '7' 
WHEN lower(state) LIKE '%borno%' THEN '8' 
WHEN lower(state) LIKE '%cross%' THEN '9' 
WHEN lower(state) LIKE '%delta%' THEN '10' 
WHEN lower(state) LIKE '%ebonyi%' THEN '11' 
WHEN lower(state) LIKE '%edo%' THEN '12' 
WHEN lower(state) LIKE '%ekiti%' THEN '13' 
WHEN lower(state) LIKE '%enugu%' THEN '14' 
WHEN lower(state) LIKE '%fct%' THEN '15' 
WHEN lower(state) LIKE '%abuja%' THEN '15' 
WHEN lower(state) LIKE '%gombe%' THEN '16' 
WHEN lower(state) LIKE '%imo%' THEN '17' 
WHEN lower(state) LIKE '%jigawa%' THEN '18' 
WHEN lower(state) LIKE '%kaduna%' THEN '19' 
WHEN lower(state) LIKE '%kano%' THEN '20' 
WHEN lower(state) LIKE '%katsina%' THEN '21' 
WHEN lower(state) LIKE '%kebbi%' THEN '22' 
WHEN lower(state) LIKE '%kogi%' THEN '23' 
WHEN lower(state) LIKE '%kwara%' THEN '24' 
WHEN lower(state) LIKE '%lagos%' THEN '25' 
WHEN lower(state) LIKE '%nasarawa%' THEN '26' 
WHEN lower(state) LIKE '%niger%' THEN '27' 
WHEN lower(state) LIKE '%ogun%' THEN '28' 
WHEN lower(state) LIKE '%ondo%' THEN '29' 
WHEN lower(state) LIKE '%osun%' THEN '30' 
WHEN lower(state) LIKE '%oyo%' THEN '31' 
WHEN lower(state) LIKE '%plateau%' THEN '32' 
WHEN lower(state) LIKE '%rivers%' THEN '33' 
WHEN lower(state) LIKE '%sokoto%' THEN '34' 
WHEN lower(state) LIKE '%taraba%' THEN '35' 
WHEN lower(state) LIKE '%yobe%' THEN '36' 
WHEN lower(state) LIKE '%zamfara%' THEN '37' 
ELSE '' 
END as state,hospitalid as HospitalNumber, enroldate as DateOfFirstReport,enroldate as DiagnosisDate,age as PatientAge,CASE serviceentry 
WHEN 'STI' THEN 1 
WHEN 'OPD' THEN 2 
WHEN 'HCT' THEN 3 
WHEN 'Private' THEN 5 
WHEN 'TB' THEN 6 
WHEN 'Ward' THEN 7 
WHEN 'Casualty' THEN 8 
WHEN 'ANC/PMTCT' THEN 9 
WHEN 'Current Clinic Patient' THEN 12 
WHEN 'Self Referral' THEN 13  
ELSE '' END as CareEntryPoint,hivposdate as FirstConfirmedHIVTestDate,CASE WHEN lower(hivmode) LIKE '%ab%' THEN 'HIVAb'
WHEN lower(hivmode) LIKE '%pcr%' THEN 'HIVPCR'
ELSE '' END as FirstHIVTestMode,testlocation as WhereFirstHIVTest, CASE priorart 
WHEN 'Transfer in with records' THEN 'T' 
WHEN 'Earlier ARV but not a transfer in' THEN 'NT'
WHEN 'PMTCT only' THEN 'P' 
WHEN 'None' THEN 'N' 
ELSE '' END as PriorArt,dateeligible as MedicallyEligibleDate,CASE whyeligible 
WHEN 'CD4' THEN '2' 
WHEN 'TLC' THEN '4' 
WHEN 'Clinically only' THEN '1'
ELSE '' END as ReasonMedicallyEligible,dateinitadh as InitialAdherenceCounselingCompletedDate,CASE firstartregimen 
WHEN 'AZT/3TC/EFV' THEN '1a' 
WHEN 'AZT/3TC/NVP' THEN '1b' 
WHEN 'TDF/FTC/EFV' THEN '1c' 
WHEN 'TDF/FTC/NVP' THEN '1d' 
WHEN 'TDF/3TC/EFV' THEN '1e' 
WHEN 'TDF/3TC/NVP' THEN '1f' 
WHEN 'AZT/3TC/ABC' THEN '1g' 
WHEN 'AZT/3TC/TDF' THEN '1h' 
WHEN 'TDF/FTC/LPV/r' THEN '2a' 
WHEN 'TDF/3TC/LPV/r' THEN '2b' 
WHEN 'TDF/FTC/ATV/r' THEN '2c' 
WHEN 'TDF/3TC/ATV/r' THEN '2d' 
WHEN 'AZT/3TC/LPV/r' THEN '2e' 
WHEN 'AZT/3TC/ATV/r' THEN '2f' 
WHEN 'TLC' THEN '4' 

ELSE '' END as Code,CASE firstartregimen 
WHEN 'AZT/3TC/EFV' THEN 'AZT-3TC-EFV' 
WHEN 'AZT/3TC/NVP' THEN 'AZT-3TC-NVP' 
WHEN 'TDF/FTC/EFV' THEN 'TDF-FTC-EFV' 
WHEN 'TDF/FTC/NVP' THEN 'TDF-FTC-NVP' 
WHEN 'TDF/3TC/EFV' THEN 'TDF-3TC-EFV' 
WHEN 'TDF/3TC/NVP' THEN 'TDF-3TC-NVP' 
WHEN 'AZT/3TC/ABC' THEN 'AZT-3TC-ABC' 
WHEN 'AZT/3TC/TDF' THEN 'AZT-3TC-TDF' 
WHEN 'TDF/FTC/LPV/r' THEN 'TDF-FTC-LPV/r' 
WHEN 'TDF/3TC/LPV/r' THEN 'TDF-3TC-LPV/r' 
WHEN 'TDF/FTC/ATV/r' THEN 'TDF-FTC-ATV/r' 
WHEN 'TDF/3TC/ATV/r' THEN 'TDF-3TC-ATV/r' 
WHEN 'AZT/3TC/LPV/r' THEN 'AZT-3TC-LPV/r' 
WHEN 'AZT/3TC/ATV/r' THEN 'AZT-3TC-ATV/r' 
ELSE '' END as CodeDescTxt,dateartstart AS ARTStartDate,clinicalstageart as WHOClinicalStageARTStart,peweightatart as WeightAtARTStart,CASE patfunction 
WHEN 'Working' THEN 'W' 
WHEN 'Ambulant' THEN 'A' 
WHEN 'Bedridden' THEN 'B' 
ELSE '' END as FunctionalStatusStartART,cd4atart as CD4AtStartOfART,enroldate as EnrolledInHIVCareDate,CASE b.tbstatus 
WHEN 'No Signs' THEN '1' 
WHEN 'TB Suspected and referred for evaluation' THEN '2' 
WHEN 'On INH prophylaxis' THEN '3' 
WHEN 'Currently on TB treatment' THEN '4' 
WHEN 'TB positive, Not on drugs' THEN '5' 
ELSE '' END as InitialTBStatus,b.clinicevalid as VisitID,b.visitdate as VisitDate,CASE b.artduration 
WHEN '' THEN 0
ELSE b.artduration END as DurationOnArt,b.weight as Weight,b.bp as BloodPressure,CASE b.fp 
WHEN 'Condoms' THEN 'FP1' 
WHEN 'Oral contraceptive pills' THEN 'FP2' 
WHEN 'Injectable/Implantable hormones' THEN 'FP3' 
WHEN 'Diaphragm/cervical caps' THEN 'FP4' 
WHEN 'Intra uterine device' THEN 'FP5' 
WHEN 'Vasectomy/tubal ligation/hysterectomy' THEN 'FP6' 
WHEN 'Other' THEN 'FP7' 
WHEN 'Not on family planning' THEN 'NOFP'
ELSE '' END as PatientFamilyPlanningMethodCode,CASE b.functionalstatus 
WHEN 'Working' THEN 'W' 
WHEN 'Ambulant' THEN 'A' 
WHEN 'Bedridden' THEN 'B' 
ELSE '' END as FunctionalStatus,b.whostage AS WHOClinicalStage,CASE b.tbstatus 
WHEN 'No Signs' THEN '1' 
WHEN 'TB Suspected and referred for evaluation' THEN '2' 
WHEN 'On INH prophylaxis' THEN '3' 
WHEN 'Currently on TB treatment' THEN '4' 
WHEN 'TB positive, Not on drugs' THEN 'B' 
ELSE '' END as TBStatus,CASE  
WHEN b.cotrimdose like '%480%' THEN 'CTX480' 
WHEN b.cotrimdose like '%960%' THEN 'CTX960' 
ELSE '' END as CodeCTX,CASE  
WHEN b.cotrimdose like '%480%' THEN 'Cotrimoxazole 480mg' 
WHEN b.cotrimdose like '%960%' THEN 'Cotrimoxazole 960mg' 
ELSE '' END as CodeDescTxtCTX,c.labid as VisitID,c.VisitDate as VisitDate,c.reportdate as CollectionDate,CASE c.baselineorrepeat 
WHEN 'Baseline' THEN 'B' 
WHEN 'Repeat' THEN 'R' 
ELSE '' END as BaselineRepeatCode,CASE c.artstatus 
WHEN 'ART' THEN 'A' 
WHEN 'Non-ART' THEN 'N' 
ELSE '' END as ARTStatusCode,results as Value1,c.clinicianname as Clinician,c.reportedby as ReportedBy,c.CheckedBy as checkedby,d.pharmacyid as VisitIDpharm,d.visitdate as VisitDatepharm,CASE drugname1 
WHEN 'AZT/3TC/EFV' THEN '1a' 
WHEN 'AZT/3TC/NVP' THEN '1b' 
WHEN 'TDF/FTC/EFV' THEN '1c' 
WHEN 'TDF/FTC/NVP' THEN '1d' 
WHEN 'TDF/3TC/EFV' THEN '1e' 
WHEN 'TDF/3TC/NVP' THEN '1f' 
WHEN 'AZT/3TC/ABC' THEN '1g' 
WHEN 'AZT/3TC/TDF' THEN '1h' 
WHEN 'TDF/FTC/LPV/r' THEN '2a' 
WHEN 'TDF/3TC/LPV/r' THEN '2b' 
WHEN 'TDF/FTC/ATV/r' THEN '2c' 
WHEN 'TDF/3TC/ATV/r' THEN '2d' 
WHEN 'AZT/3TC/LPV/r' THEN '2e' 
WHEN 'AZT/3TC/ATV/r' THEN '2f' 
WHEN 'TLC' THEN '4' 
ELSE '' END as CodePharmDrgName1,CASE d.drugname1 
WHEN 'AZT/3TC/EFV' THEN 'AZT-3TC-EFV' 
WHEN 'AZT/3TC/NVP' THEN 'AZT-3TC-NVP' 
WHEN 'TDF/FTC/EFV' THEN 'TDF-FTC-EFV' 
WHEN 'TDF/FTC/NVP' THEN 'TDF-FTC-NVP' 
WHEN 'TDF/3TC/EFV' THEN 'TDF-3TC-EFV' 
WHEN 'TDF/3TC/NVP' THEN 'TDF-3TC-NVP' 
WHEN 'AZT/3TC/ABC' THEN 'AZT-3TC-ABC' 
WHEN 'AZT/3TC/TDF' THEN 'AZT-3TC-TDF' 
WHEN 'TDF/FTC/LPV/r' THEN 'TDF-FTC-LPV/r' 
WHEN 'TDF/3TC/LPV/r' THEN 'TDF-3TC-LPV/r' 
WHEN 'TDF/FTC/ATV/r' THEN 'TDF-FTC-ATV/r' 
WHEN 'TDF/3TC/ATV/r' THEN 'TDF-3TC-ATV/r' 
WHEN 'AZT/3TC/LPV/r' THEN 'AZT-3TC-LPV/r' 
WHEN 'AZT/3TC/ATV/r' THEN 'AZT-3TC-ATV/r' 
ELSE '' END as CodeDescTxtPharmDrgName1,d.visitdate as PrescribedRegimenDispensedDate,CASE  
WHEN (d.oidrug like '%CTX%' AND d.oiqty='480mg') THEN 'CTX480' 
WHEN (d.oidrug like '%CTX%' AND d.oiqty='960mg') THEN 'CTX960' 
ELSE '' END AS Code_oi,CASE  
WHEN (d.oidrug like '%CTX%' AND d.oiqty='480mg') THEN 'Cotrimoxazole 480mg' 
WHEN (d.oidrug like '%CTX%' AND d.oiqty='960mg') THEN 'Cotrimoxazole 960mg' 
ELSE '' END AS CodeDescTxt_OI,b.nextapptdate as NextAppointmentDate,CASE d.drugname1 
WHEN 'AZT/3TC/EFV' THEN '10' 
WHEN 'AZT/3TC/NVP' THEN '10' 
WHEN 'TDF/FTC/EFV' THEN '10' 
WHEN 'TDF/FTC/NVP' THEN '10' 
WHEN 'TDF/3TC/EFV' THEN '10' 
WHEN 'TDF/3TC/NVP' THEN '10' 
WHEN 'AZT/3TC/EFV' THEN '10' 
WHEN 'AZT/3TC/NVP' THEN '10' 
WHEN 'ABC/3TC/EFV' THEN '10'
WHEN 'AZT/3TC/ABC' THEN '11'
WHEN 'AZT/3TC/TDF' THEN '11'
WHEN 'ABC/3TC/NVP' THEN '11'
WHEN 'AZT/3TC/ABC' THEN '11'
WHEN 'ABC/3TC/EFV' THEN '11'
WHEN 'ABC/3TC/EFV' THEN '11'
WHEN 'TDF/FTC/LPV/r' THEN '20'
WHEN 'TDF/3TC/LPV/r' THEN '20'
WHEN 'TDF/FTC/ATV/r' THEN '20'
WHEN 'TDF/3TC/ATV/r' THEN '20'
WHEN 'AZT/3TC/LPV/r' THEN '20'
WHEN 'AZT/3TC/ATV/r' THEN '20'
WHEN 'ABC/3TC/LPV/r' THEN '20'
WHEN 'AZT/3TC/LPV/r' THEN '20' 
WHEN 'd4T/3TC/LPV/r' THEN '20' 
WHEN 'ddi/3TC/NVP' THEN '20' 
WHEN 'ABC/3TC/ddi' THEN '20' 
WHEN 'DAR' THEN '30' 
WHEN 'RAL' THEN '30' 
WHEN 'ETR' THEN '30' 
WHEN 'RTV' THEN '30' 
ELSE '' END as PrescribedRegimenLineCode,d.regduration1 as PrescribedRegimenDuration,CASE d.oiduration 
WHEN '1 month' THEN '30' 
WHEN '2 month' THEN '60' 
WHEN '3 month' THEN '90' 
WHEN '4 month' THEN '120' 
ELSE '' END as PrescribedRegimenDurationCTXpharm,CASE d.tbduration 
WHEN '1 month' THEN '30' 
WHEN '2 month' THEN '60' 
WHEN '3 month' THEN '90' 
WHEN '4 month' THEN '120' 
ELSE '' END as PrescribedRegimenDurationTBpharm,b.cd4value as cd4value,CASE  
WHEN d.tbdrug LIKE '%INH%' and d.tbdrug LIKE '%Rifampicin%' AND d.tbdrug LIKE '%PZI%' AND d.tbdrug LIKE '%Streptomycin Injection%' AND d.tbdrug LIKE '%Ethambutol%' THEN 'HRZES'
WHEN d.tbdrug LIKE '%INH%' and d.tbdrug LIKE '%Rifampicin%' AND d.tbdrug LIKE '%PZI%' AND d.tbdrug LIKE '%Ethambutol%' THEN 'HRZE' 
WHEN d.tbdrug LIKE '%INH%' and d.tbdrug LIKE '%Rifampicin%' AND d.tbdrug LIKE '%Ethambutol%' THEN 'HRE' 
WHEN d.tbdrug LIKE '%INH%' and d.tbdrug LIKE '%Rifampicin%' AND d.tbdrug LIKE '%Streptomycin Injection%' THEN 'HRS' 
WHEN d.tbdrug LIKE '%INH%' and d.tbdrug LIKE '%Rifampicin%' THEN 'HR' 
WHEN d.tbdrug LIKE '%INH%' AND d.tbdrug LIKE '%Ethambutol%' THEN 'HE' 
WHEN d.tbdrug LIKE '%Streptomycin Injection%' THEN 'S' 
WHEN d.tbdrug LIKE '%PZI%' THEN 'Z' 
WHEN d.tbdrug LIKE '%Ethambutol%' THEN 'E' 
WHEN d.tbdrug LIKE '%Rifampicin%' THEN 'R' 
WHEN d.tbdrug LIKE '%INH%' THEN 'H'  
ELSE '' END as tbdrugcode,d.tbdrug as tbdrug,c.labregno as LaboratoryTestIdentifier
from patient a LEFT JOIN (select * from clinicaleval where pepid='$_POST[pepid]' order by visitdate DESC LIMIT 1) b
ON (a.pepid=b.pepid)
LEFT JOIN (select * from laboratory where pepid='$_POST[pepid]' and tests='CD4' order by visitdate DESC LIMIT 1) c
ON (a.pepid=c.pepid)
LEFT JOIN (select * from pharmacy where pepid='$_POST[pepid]' order by visitdate DESC LIMIT 1) d
ON (a.pepid=d.pepid)
where a.pepid='$_POST[pepid]'";

		include './mandate_/lidh.php';

        $resultndr = mysqli_query($con,$query);
        $infondr = mysqli_fetch_assoc($resultndr);
        return $infondr;
    }
}
$classndr = new MyClassndr;
$infondr = $classndr->GetUserInformation();
echo mysql_error();
{
	include './mandate_/lidhX.php';
$sql="INSERT into AUDIT_TRAIL (server_name,user_name,action) VALUES('$_SERVER[REMOTE_ADDR]','$_SESSION[login_id]','UPDATE - I.E.: $_POST[pepid]')";
$result=mysqli_query($con,$sql);
}
try 
{ 
    /*** a new dom object ***/ 
    $dom = new domDocument; 

    /*** make the output tidy ***/ 
    $dom->formatOutput = true; 

    /*** create the root element ***/ 
    $root = $dom->appendChild($dom->createElement( "Container" )); 

    /*** create the simple xml element ***/ 
    $Container = simplexml_import_dom( $dom ); 
	

    /*** add a MessageHeader element ***/ 
	$MessageHeader = $Container->addChild("MessageHeader"); 
	$MessageHeader->addChild("MessageStatusCode", "UPDATED"); 
    $MessageHeader->addChild("MessageCreationDateTime", date('Y-m-d\TH:i:s')); 
    $MessageHeader->addChild("MessageSchemaVersion", "1.2"); 
	$MessageHeader->addChild("MessageUniqueID", date('YmdHis')); 
	
	/*** add a MessageSendingOrganization element ***/
	$MessageSendingOrganization = $MessageHeader->addChild("MessageSendingOrganization"); 
	$MessageSendingOrganization->addChild("FacilityName", "AIDS Prevention Initiative In Nigeria"); 
    $MessageSendingOrganization->addChild("FacilityID",  "APIN"); 
    $MessageSendingOrganization->addChild("FacilityTypeCode", "IP"); 
    
	/*** add a IndividualReport element ***/ 
	$IndividualReport = $Container->addChild("IndividualReport"); 
	
	/////////////////////////////////////////////////////////////Start Patient Demographics//////////////////////////////////// 
	$PatientDemographics = $IndividualReport->addChild("PatientDemographics"); 
	
	///// add patientidentifer//////////////////
	$PatientDemographics->addChild("PatientIdentifier", $infondr['PatientIdentifier']); 
	/////////add treatment facility
	$TreatmentFacility = $PatientDemographics->addChild("TreatmentFacility");
	$TreatmentFacility->addChild("FacilityName", $infondr['FacilityName']);
	$TreatmentFacility->addChild("FacilityID", substr($infondr['PatientIdentifier'],0,2));
	$TreatmentFacility->addChild("FacilityTypeCode", "FAC");
	///////////////////add OtherPatientIdentifiers //////////////////////////
	$OtherPatientIdentifiers = $PatientDemographics->addChild("OtherPatientIdentifiers");
	$Identifier = $OtherPatientIdentifiers->addChild("Identifier");
	$Identifier->addChild("IDNumber", $infondr['IDNumber']);
	$Identifier->addChild("IDTypeCode", "PN");
	
	$PatientDemographics->addChild("PatientDateOfBirth", $infondr['PatientDateOfBirth']);
	$PatientDemographics->addChild("PatientSexCode", $infondr['PatientSexCode']);
	$PatientDemographics->addChild("PatientDeceasedIndicator", $infondr['PatientDeceasedIndicator']);
	//$PatientDemographics->addChild("PatientPrimaryLanguageCode", "");
	$PatientDemographics->addChild("PatientEducationLevelCode", $infondr['PatientEducationLevelCode']);
	$PatientDemographics->addChild("PatientOccupationCode", $infondr['PatientOccupationCode']);
	$PatientDemographics->addChild("PatientMaritalStatusCode", $infondr['PatientMaritalStatusCode']);
	$PatientDemographics->addChild("StateOfNigeriaOriginCode", $infondr['state']);
	
	/////////////////////////////////////////////////////////////End Patient Demographics//////////////////////////////////// 
	
	/////////////////////////////////////////////////////////////Start Condition//////////////////////////////////// 
	$Condition = $IndividualReport->addChild("Condition"); 
	$Condition->addChild("ConditionCode", $infondr['ConditionCode']);
	////// add program area //////
	$ProgramArea = $Condition->addChild("ProgramArea"); 
	$ProgramArea->addChild("ProgramAreaCode", "HIV");
	///////////////// add patient address //////////////////
	$PatientAddress = $Condition->addChild("PatientAddress"); 
	$PatientAddress->addChild("AddressTypeCode", "H");
	$PatientAddress->addChild("WardVillage", $infondr['WardVillage']);
	$PatientAddress->addChild("Town", $infondr['town']);
	$PatientAddress->addChild("LGACode", "236");
	$PatientAddress->addChild("StateCode", $infondr['state']);
	$PatientAddress->addChild("CountryCode", "NGA");
	$PatientAddress->addChild("PostalCode", "");
	$PatientAddress->addChild("OtherAddressInformation", "");
	
	/////// add CommonQuestions ///////
	$CommonQuestions = $Condition->addChild("CommonQuestions"); 
	$CommonQuestions->addChild("HospitalNumber", $infondr['HospitalNumber']);
	$DiagnosisFacility = $CommonQuestions->addChild("DiagnosisFacility"); 
	$DiagnosisFacility->addChild("FacilityName", $infondr['FacilityName']);
	$DiagnosisFacility->addChild("FacilityID", substr($infondr['PatientIdentifier'],0,2));
	$DiagnosisFacility->addChild("FacilityTypeCode", "FAC");
	
	$CommonQuestions->addChild("DateOfFirstReport",  $infondr['DateOfFirstReport']);
	//$CommonQuestions->addChild("DateOfLastReport", "");
	$CommonQuestions->addChild("DiagnosisDate", $infondr['DateOfFirstReport']);
	$CommonQuestions->addChild("PatientDieFromThisIllness",  $infondr['PatientDeceasedIndicator']);
	$CommonQuestions->addChild("PatientAge", $infondr['PatientAge']);
	
	/////// add ConditionSpecificQuestions ///////
	$ConditionSpecificQuestions = $Condition->addChild("ConditionSpecificQuestions");
	$HIVQuestions = $ConditionSpecificQuestions->addChild("HIVQuestions");
	if($infondr['CareEntryPoint']==''){
		//$HIVQuestions->addChild("CareEntryPoint", $infondr['CareEntryPoint']);
	}
	else{
		$HIVQuestions->addChild("CareEntryPoint", $infondr['CareEntryPoint']);
	}
	$HIVQuestions->addChild("FirstConfirmedHIVTestDate", $infondr['FirstConfirmedHIVTestDate']);
	if ($infondr['FirstHIVTestMode']==''){
		//$HIVQuestions->addChild("FirstHIVTestMode", $infondr['FirstHIVTestMode']);
	}
	else{
		$HIVQuestions->addChild("FirstHIVTestMode", $infondr['FirstHIVTestMode']);
	}
	$HIVQuestions->addChild("WhereFirstHIVTest", $infondr['WhereFirstHIVTest']);
	$HIVQuestions->addChild("PriorArt", $infondr['PriorArt']);
	if($infondr['MedicallyEligibleDate']==''){
		//$HIVQuestions->addChild("MedicallyEligibleDate", $infondr['MedicallyEligibleDate']);
	}
	else{
		$HIVQuestions->addChild("MedicallyEligibleDate", $infondr['MedicallyEligibleDate']);
	}
	if($infondr['ReasonMedicallyEligible']==''){
		//$HIVQuestions->addChild("ReasonMedicallyEligible", $infondr['ReasonMedicallyEligible']);
	}else{
		$HIVQuestions->addChild("ReasonMedicallyEligible", $infondr['ReasonMedicallyEligible']);
	}
	if($infondr['InitialAdherenceCounselingCompletedDate']==''){
		//$HIVQuestions->addChild("InitialAdherenceCounselingCompletedDate", $infondr['InitialAdherenceCounselingCompletedDate']);
	}else{
		$HIVQuestions->addChild("InitialAdherenceCounselingCompletedDate", $infondr['InitialAdherenceCounselingCompletedDate']);
	}
	
	///// add first art regime //////
	$FirstARTRegimen = $HIVQuestions->addChild("FirstARTRegimen");
	$FirstARTRegimen->addChild("Code", $infondr['Code']);
	$FirstARTRegimen->addChild("CodeDescTxt", $infondr['CodeDescTxt']);
	if($infondr['ARTStartDate']==''){
		//$HIVQuestions->addChild("ARTStartDate", $infondr['ARTStartDate']);
	}else{
		$HIVQuestions->addChild("ARTStartDate", $infondr['ARTStartDate']);
	}
	if($infondr['WHOClinicalStageARTStart']==''){
		//$HIVQuestions->addChild("WHOClinicalStageARTStart", $infondr['WHOClinicalStageARTStart']);
	}else{
		$HIVQuestions->addChild("WHOClinicalStageARTStart", $infondr['WHOClinicalStageARTStart']);
	}
	if($infondr['WeightAtARTStart']==''){
		//$HIVQuestions->addChild("WeightAtARTStart", $infondr['WeightAtARTStart']);
	}else{
			$HIVQuestions->addChild("WeightAtARTStart", $infondr['WeightAtARTStart']);
	}
	if($infondr['FunctionalStatusStartART']==''){
		//$HIVQuestions->addChild("FunctionalStatusStartART", $infondr['FunctionalStatusStartART']);
	}else{
		$HIVQuestions->addChild("FunctionalStatusStartART", $infondr['FunctionalStatusStartART']);
	}
	
	$HIVQuestions->addChild("CD4AtStartOfART", $infondr['CD4AtStartOfART']);
	$HIVQuestions->addChild("PatientHasDied", $infondr['PatientDeceasedIndicator']);
	$HIVQuestions->addChild("EnrolledInHIVCareDate", $infondr['EnrolledInHIVCareDate']);
	if($infondr['InitialTBStatus']==''){
		//$HIVQuestions->addChild("InitialTBStatus", $infondr['InitialTBStatus']);
	}else{
		$HIVQuestions->addChild("InitialTBStatus", $infondr['InitialTBStatus']);
	}
	
	
	
	/////// add Encounters ///////
	if($infondr['VisitID']==''){
	//$Encounters = $Condition->addChild("Encounters");
	//$HIVEncounter = $Encounters->addChild("HIVEncounter");
	//$HIVEncounter->addChild("VisitID", $infondr['VisitID']);
	}else{
	$Encounters = $Condition->addChild("Encounters");
	$HIVEncounter = $Encounters->addChild("HIVEncounter");
	$HIVEncounter->addChild("VisitID", $infondr['VisitID']);		
	}
	if($infondr['VisitDate']==''){
		//$HIVEncounter->addChild("VisitDate", $infondr['VisitDate']);
	}else{
		$HIVEncounter->addChild("VisitDate", $infondr['VisitDate']);
	}
	if($infondr['DurationOnArt']==''){
		//$HIVEncounter->addChild("DurationOnArt", $infondr['DurationOnArt']);
	}else{
		$HIVEncounter->addChild("DurationOnArt", $infondr['DurationOnArt']);
	}
	if($infondr['Weight']==''){
		//$HIVEncounter->addChild("Weight", $infondr['Weight']);
	}else{
		$HIVEncounter->addChild("Weight", $infondr['Weight']);
	}
	if($infondr['BloodPressure']==''){
		//$HIVEncounter->addChild("BloodPressure", $infondr['BloodPressure']);
	}else{
		$HIVEncounter->addChild("BloodPressure", $infondr['BloodPressure']);
	}
	if($infondr['VisitDate']==''){
		//$HIVEncounter->addChild("PatientFamilyPlanningCode", "FP");
		//$HIVEncounter->addChild("PatientFamilyPlanningMethodCode", $infondr['PatientFamilyPlanningMethodCode']);
	}else{
		$HIVEncounter->addChild("PatientFamilyPlanningCode", "FP");
		$HIVEncounter->addChild("PatientFamilyPlanningMethodCode", $infondr['PatientFamilyPlanningMethodCode']);
	}
	
	
	if($infondr['FunctionalStatus']==''){
		//$HIVEncounter->addChild("FunctionalStatus", $infondr['FunctionalStatus']);
	}else{
		$HIVEncounter->addChild("FunctionalStatus", $infondr['FunctionalStatus']);
	}
	if($infondr['WHOClinicalStage']==''){
		//$HIVEncounter->addChild("WHOClinicalStage", $infondr['WHOClinicalStage']);
	}else{
		$HIVEncounter->addChild("WHOClinicalStage", $infondr['WHOClinicalStage']);
	}
	if($infondr['TBStatus']==''){
		//$HIVEncounter->addChild("TBStatus", $infondr['TBStatus']);
	}else{
		$HIVEncounter->addChild("TBStatus", $infondr['TBStatus']);
	}
	
	if($infondr['VisitDate']==''){
	//$ARVDrugRegimen = $HIVEncounter->addChild("ARVDrugRegimen");
	//$ARVDrugRegimen->addChild("Code", $infondr['Code']);
	//$ARVDrugRegimen->addChild("CodeDescTxt", $infondr['CodeDescTxt']);
	//$CotrimoxazoleDose = $HIVEncounter->addChild("CotrimoxazoleDose");
	//$CotrimoxazoleDose->addChild("Code", $infondr['CodeCTX']);
	//$CotrimoxazoleDose->addChild("CodeDescTxt", $infondr['CodeDescTxtCTX']);
	}else{
	$ARVDrugRegimen = $HIVEncounter->addChild("ARVDrugRegimen");
	$ARVDrugRegimen->addChild("Code", $infondr['Code']);
	$ARVDrugRegimen->addChild("CodeDescTxt", $infondr['CodeDescTxt']);	
	$CotrimoxazoleDose = $HIVEncounter->addChild("CotrimoxazoleDose");
	$CotrimoxazoleDose->addChild("Code", $infondr['CodeCTX']);
	$CotrimoxazoleDose->addChild("CodeDescTxt", $infondr['CodeDescTxtCTX']);
	}

	
	//$INHDose = $HIVEncounter->addChild("INHDose");
	//$INHDose->addChild("Code", "");
	//$INHDose->addChild("CodeDescTxt", "");
	if($infondr['cd4value']==''&&$infondr['VisitDate']==''){
		//$HIVEncounter->addChild("CD4", $infondr['cd4value']);
		//$HIVEncounter->addChild("CD4TestDate", $infondr['VisitDate']);
	}else{
		$HIVEncounter->addChild("CD4", $infondr['cd4value']);
		$HIVEncounter->addChild("CD4TestDate", $infondr['VisitDate']);
	}
	
	
	if($infondr['NextAppointmentDate']==''){
		//$HIVEncounter->addChild("NextAppointmentDate", $infondr['NextAppointmentDate']);
	}
	else{
		$HIVEncounter->addChild("NextAppointmentDate", $infondr['NextAppointmentDate']);
	}
	
	/////// add LaboratoryReport ///////
	if($infondr['VisitID']==''){
	//$LaboratoryReport = $Condition->addChild("LaboratoryReport");
	//$LaboratoryReport->addChild("VisitID", $infondr['VisitID']);
	}else{
	$LaboratoryReport = $Condition->addChild("LaboratoryReport");
	$LaboratoryReport->addChild("VisitID", $infondr['VisitID']);
		
	}
	if($infondr['VisitDate']==''){
		//$LaboratoryReport->addChild("VisitDate", $infondr['VisitDate']);
	}else{
		$LaboratoryReport->addChild("VisitDate", $infondr['VisitDate']);
	}
	
	if($infondr['LaboratoryTestIdentifier']==''){
		//$LaboratoryReport->addChild("LaboratoryTestIdentifier", $infondr['LaboratoryTestIdentifier']);
	}
	else{
		$LaboratoryReport->addChild("LaboratoryTestIdentifier", $infondr['LaboratoryTestIdentifier']);
	}
	if($infondr['CollectionDate']==''){
		//$LaboratoryReport->addChild("CollectionDate", $infondr['CollectionDate']);
	}else{
		$LaboratoryReport->addChild("CollectionDate", $infondr['CollectionDate']);
	}
	if($infondr['BaselineRepeatCode']==''){
		//$LaboratoryReport->addChild("BaselineRepeatCode", $infondr['BaselineRepeatCode']);
	}else{
		$LaboratoryReport->addChild("BaselineRepeatCode", $infondr['BaselineRepeatCode']);
	}
	if($infondr['ARTStatusCode']==''){
		//$LaboratoryReport->addChild("ARTStatusCode", $infondr['ARTStatusCode']);
	}else{
		$LaboratoryReport->addChild("ARTStatusCode", $infondr['ARTStatusCode']);
	}
	
	
	if($infondr['VisitDate']==''){
		//$LaboratoryOrderAndResult->addChild("OrderedTestDate", $infondr['VisitDate']);
		//$LaboratoryOrderAndResult = $LaboratoryReport->addChild("LaboratoryOrderAndResult");
		//$LaboratoryResultedTest = $LaboratoryOrderAndResult->addChild("LaboratoryResultedTest");
		//$LaboratoryResultedTest->addChild("Code", "11");
		//$LaboratoryResultedTest->addChild("CodeDescTxt", "CD4");
		//$LaboratoryResult = $LaboratoryOrderAndResult->addChild("LaboratoryResult");
		//$AnswerNumeric = $LaboratoryResult->addChild("AnswerNumeric");
	}else{
		$LaboratoryOrderAndResult = $LaboratoryReport->addChild("LaboratoryOrderAndResult");
		$LaboratoryOrderAndResult->addChild("OrderedTestDate", $infondr['VisitDate']);
		$LaboratoryResultedTest = $LaboratoryOrderAndResult->addChild("LaboratoryResultedTest");
		$LaboratoryResultedTest->addChild("Code", "11");
		$LaboratoryResultedTest->addChild("CodeDescTxt", "CD4");
		$LaboratoryResult = $LaboratoryOrderAndResult->addChild("LaboratoryResult");
		$AnswerNumeric = $LaboratoryResult->addChild("AnswerNumeric");
	}
	
	
	
	
	
	
	if($infondr['Value1']==''){
		//$AnswerNumeric->addChild("Value1", $infondr['Value1']);
	}else{
		$AnswerNumeric->addChild("Value1", $infondr['Value1']);
	}
	if($infondr['VisitDate']==''){
		//$LaboratoryOrderAndResult->addChild("ResultedTestDate", $infondr['VisitDate']);
		//$LaboratoryReport->addChild("Clinician", $infondr['Clinician']);
		//$LaboratoryReport->addChild("ReportedBy", $infondr['ReportedBy']);
		//$LaboratoryReport->addChild("CheckedBy", $infondr['checkedby']);		
	}else{
		$LaboratoryOrderAndResult->addChild("ResultedTestDate", $infondr['VisitDate']);
		$LaboratoryReport->addChild("Clinician", $infondr['Clinician']);
		$LaboratoryReport->addChild("ReportedBy", $infondr['ReportedBy']);
		$LaboratoryReport->addChild("CheckedBy", $infondr['checkedby']);	
	}
	
	

	
	/////// add Regimen 1 ///////
	if($infondr['CodeDescTxtPharmDrgName1']==''){
	//$Regimen = $Condition->addChild("Regimen");
	//$Regimen->addChild("VisitID", $infondr['VisitIDpharm']);
	//$Regimen->addChild("VisitDate", $infondr['VisitDatepharm']);
	
	//$PrescribedRegimen = $Regimen->addChild("PrescribedRegimen");
	//$PrescribedRegimen->addChild("Code", $infondr['CodePharmDrgName1']);
	//$PrescribedRegimen->addChild("CodeDescTxt", $infondr['CodeDescTxtPharmDrgName1']);
	
	//$Regimen->addChild("PrescribedRegimenTypeCode", "ART");
	//$Regimen->addChild("PrescribedRegimenLineCode", $infondr['PrescribedRegimenLineCode']);
	//$Regimen->addChild("PrescribedRegimenDuration", $infondr['PrescribedRegimenDuration']);
	//$Regimen->addChild("PrescribedRegimenDispensedDate", $infondr['PrescribedRegimenDispensedDate']);
	//$Regimen->addChild("DateRegimenStarted", $info1['DateRegimenStarted']);
	//$Regimen->addChild("DateRegimenStartedDD", $info1['DateRegimenStartedDD']);
	//$Regimen->addChild("DateRegimenStartedMM", $info1['DateRegimenStartedMM']);
	//$Regimen->addChild("DateRegimenStartedYYYY", $info1['DateRegimenStartedYYYY']);
	//$Regimen->addChild("PrescribedRegimenInitialIndicator", "false");
	//$Regimen->addChild("PrescribedRegimenCurrentIndicator", "false");
	//$Regimen->addChild("TypeOfPreviousExposureCode", "N");
	//$Regimen->addChild("SubstitutionIndicator", "false");
	//$Regimen->addChild("SwitchIndicator", "false");
	}
	else{
		include './mandate_/lidh2.php';
		$sql="SELECT dispensedate as DateRegimenStarted,DATE_FORMAT(dispensedate,'%d') as DateRegimenStartedDD,DATE_FORMAT(dispensedate,'%c') as DateRegimenStartedMM,DATE_FORMAT(dispensedate,'%Y') as DateRegimenStartedYYYY FROM pharmacy where pepid='IF-16-0008' and REPLACE(drugname1, '/', '-')='$infondr[CodeDescTxtPharmDrgName1]' order by visitdate ASC LIMIT 1";
		$result=mysqli_query($con,$sql);
		$info1=mysqli_fetch_assoc($result);
		
	$Regimen = $Condition->addChild("Regimen");
	$Regimen->addChild("VisitID", $infondr['VisitIDpharm']);
	$Regimen->addChild("VisitDate", $infondr['VisitDatepharm']);
	
	$PrescribedRegimen = $Regimen->addChild("PrescribedRegimen");
	$PrescribedRegimen->addChild("Code", $infondr['CodePharmDrgName1']);
	$PrescribedRegimen->addChild("CodeDescTxt", $infondr['CodeDescTxtPharmDrgName1']);
	
	$Regimen->addChild("PrescribedRegimenTypeCode", "ART");
	$Regimen->addChild("PrescribedRegimenLineCode", $infondr['PrescribedRegimenLineCode']);
	$Regimen->addChild("PrescribedRegimenDuration", $infondr['PrescribedRegimenDuration']);
	$Regimen->addChild("PrescribedRegimenDispensedDate", $infondr['PrescribedRegimenDispensedDate']);
	$Regimen->addChild("DateRegimenStarted", $info1['DateRegimenStarted']);
	$Regimen->addChild("DateRegimenStartedDD", $info1['DateRegimenStartedDD']);
	$Regimen->addChild("DateRegimenStartedMM", $info1['DateRegimenStartedMM']);
	$Regimen->addChild("DateRegimenStartedYYYY", $info1['DateRegimenStartedYYYY']);
	$Regimen->addChild("PrescribedRegimenInitialIndicator", "false");
	$Regimen->addChild("PrescribedRegimenCurrentIndicator", "false");
	$Regimen->addChild("TypeOfPreviousExposureCode", "N");
	$Regimen->addChild("SubstitutionIndicator", "false");
	$Regimen->addChild("SwitchIndicator", "false");
	}
	/////// add Regimen 2 ///////
	if($infondr['CodeDescTxtCTX']==''){
	//$Regimen = $Condition->addChild("Regimen");
	//$Regimen->addChild("VisitID", $infondr['VisitIDpharm']);
	//$Regimen->addChild("VisitDate", $infondr['VisitDatepharm']);
	
	//$PrescribedRegimen = $Regimen->addChild("PrescribedRegimen");
	//$PrescribedRegimen->addChild("Code", $infondr['CodeCTX']);
	//$PrescribedRegimen->addChild("CodeDescTxt", $infondr['CodeDescTxtCTX']);
	
	//$Regimen->addChild("PrescribedRegimenTypeCode", $infondr['PrescribedRegimenDurationCTXpharm']);
	//$Regimen->addChild("PrescribedRegimenDuration", $info1['DateRegimenStarted']);
	//$Regimen->addChild("PrescribedRegimenDispensedDate", $info1['DateRegimenStarted']);
	//$Regimen->addChild("DateRegimenStarted", $info1['DateRegimenStarted']);
	//$Regimen->addChild("DateRegimenStartedDD", $info1['DateRegimenStartedDD']);
	//$Regimen->addChild("DateRegimenStartedMM", $info1['DateRegimenStartedMM']);
	//$Regimen->addChild("DateRegimenStartedYYYY", $info1['DateRegimenStartedYYYY']);
	//$Regimen->addChild("PrescribedRegimenInitialIndicator", "true");
	//$Regimen->addChild("PrescribedRegimenCurrentIndicator", "true");
	//$Regimen->addChild("SubstitutionIndicator", "false");
	//$Regimen->addChild("SwitchIndicator", "false");
	}
	else{
		include './mandate_/lidh2.php';
		$sql="SELECT dispensedate as DateRegimenStarted,DATE_FORMAT(dispensedate,'%d') as DateRegimenStartedDD,DATE_FORMAT(dispensedate,'%c') as DateRegimenStartedMM,DATE_FORMAT(dispensedate,'%Y') as DateRegimenStartedYYYY FROM pharmacy where pepid='IF-16-0008' and oidrug='CTX' order by visitdate ASC LIMIT 1";
		$result=mysqli_query($con,$sql);
		$info1=mysqli_fetch_assoc($result);
		
	$Regimen = $Condition->addChild("Regimen");
	$Regimen->addChild("VisitID", $infondr['VisitIDpharm']);
	$Regimen->addChild("VisitDate", $infondr['VisitDatepharm']);
	
	$PrescribedRegimen = $Regimen->addChild("PrescribedRegimen");
	$PrescribedRegimen->addChild("Code", $infondr['CodeCTX']);
	$PrescribedRegimen->addChild("CodeDescTxt", $infondr['CodeDescTxtCTX']);
	
	$Regimen->addChild("PrescribedRegimenTypeCode", $infondr['PrescribedRegimenDurationCTXpharm']);
	$Regimen->addChild("PrescribedRegimenDuration", $info1['DateRegimenStarted']);
	$Regimen->addChild("PrescribedRegimenDispensedDate", $info1['DateRegimenStarted']);
	$Regimen->addChild("DateRegimenStarted", $info1['DateRegimenStarted']);
	$Regimen->addChild("DateRegimenStartedDD", $info1['DateRegimenStartedDD']);
	$Regimen->addChild("DateRegimenStartedMM", $info1['DateRegimenStartedMM']);
	$Regimen->addChild("DateRegimenStartedYYYY", $info1['DateRegimenStartedYYYY']);
	$Regimen->addChild("PrescribedRegimenInitialIndicator", "true");
	$Regimen->addChild("PrescribedRegimenCurrentIndicator", "true");
	$Regimen->addChild("SubstitutionIndicator", "false");
	$Regimen->addChild("SwitchIndicator", "false");
	}
	
	/////// add Regimen 3 ///////
	if($infondr['tbdrugcode']==''){
	//$Regimen = $Condition->addChild("Regimen");
	//$Regimen->addChild("VisitID", $infondr['VisitIDpharm']);
	//$Regimen->addChild("VisitDate", $infondr['VisitDatepharm']);
	
	//$PrescribedRegimen = $Regimen->addChild("PrescribedRegimen");
	//$PrescribedRegimen->addChild("Code", $infondr['tbdrugcode']);
	//$PrescribedRegimen->addChild("CodeDescTxt", $infondr['tbdrug']);
	
	//$Regimen->addChild("PrescribedRegimenTypeCode", "TB");
	//$Regimen->addChild("PrescribedRegimenDuration", $info2['PrescribedRegimenDurationTBpharm']);
	//$Regimen->addChild("PrescribedRegimenDispensedDate", $info2['DateRegimenStarted']);
	//$Regimen->addChild("DateRegimenStarted", $info2['DateRegimenStarted']);
	//$Regimen->addChild("DateRegimenStartedDD", $info2['DateRegimenStartedDD']);
	//$Regimen->addChild("DateRegimenStartedMM", $info2['DateRegimenStartedMM']);
	//$Regimen->addChild("DateRegimenStartedYYYY", $info2['DateRegimenStartedYYYY']);
	//$Regimen->addChild("PrescribedRegimenInitialIndicator", "true");
	//$Regimen->addChild("PrescribedRegimenCurrentIndicator", "true");
	//$Regimen->addChild("SubstitutionIndicator", "false");
	//$Regimen->addChild("SwitchIndicator", "false");
	}
	else{
		include './mandate_/lidh2.php';
		$sql="SELECT dispensedate as DateRegimenStarted,DATE_FORMAT(dispensedate,'%d') as DateRegimenStartedDD,DATE_FORMAT(dispensedate,'%c') as DateRegimenStartedMM,DATE_FORMAT(dispensedate,'%Y') as DateRegimenStartedYYYY FROM pharmacy where pepid='IF-16-0008' and (tbdrug!='' or tbdrug is not null) order by visitdate ASC LIMIT 1";
		$result=mysqli_query($con,$sql);
		$info2=mysqli_fetch_assoc($result);
	$Regimen = $Condition->addChild("Regimen");
	$Regimen->addChild("VisitID", $infondr['VisitIDpharm']);
	$Regimen->addChild("VisitDate", $infondr['VisitDatepharm']);
	
	$PrescribedRegimen = $Regimen->addChild("PrescribedRegimen");
	$PrescribedRegimen->addChild("Code", $infondr['tbdrugcode']);
	$PrescribedRegimen->addChild("CodeDescTxt", $infondr['tbdrug']);
	
	$Regimen->addChild("PrescribedRegimenTypeCode", "TB");
	$Regimen->addChild("PrescribedRegimenDuration", $infondr['PrescribedRegimenDurationTBpharm']);
	$Regimen->addChild("PrescribedRegimenDispensedDate", $info2['DateRegimenStarted']);
	$Regimen->addChild("DateRegimenStarted", $info2['DateRegimenStarted']);
	$Regimen->addChild("DateRegimenStartedDD", $info2['DateRegimenStartedDD']);
	$Regimen->addChild("DateRegimenStartedMM", $info2['DateRegimenStartedMM']);
	$Regimen->addChild("DateRegimenStartedYYYY", $info2['DateRegimenStartedYYYY']);
	$Regimen->addChild("PrescribedRegimenInitialIndicator", "true");
	$Regimen->addChild("PrescribedRegimenCurrentIndicator", "true");
	$Regimen->addChild("SubstitutionIndicator", "false");
	$Regimen->addChild("SwitchIndicator", "false");
	}
	/////////////////////////////////////////////////////////////End Condition//////////////////////////////////// 
$filen=""; 
$filen.="UPDATED_"; 
$filen.=date('YmdHis')."_";
$filen.=$_POST['pepid'];

////////////////////CREATE ndr FOLDER/////////////
if (!file_exists('c:\ndr')) {
    mkdir('c:\ndr', 0777, true);
}
    /*** echo the xml ***/ 
    $Container->asXML("c:\\ndr\\".$filen.".xml"); 
} 
catch( Exception $e ) 
{ 
    echo $e->getMessage(); 
} 
?>